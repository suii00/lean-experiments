% =============================================================================
% Structure Tower ç™ºå±•æ¼”ç¿’ Level 6
% I-adic å®Œå‚™åŒ–ã¨ StructureTowerï¼šCauchy åˆ—ãƒ»null åˆ—ãƒ»æ™®éæ€§ãƒ»ClosedTower
% LuaLaTeX + ltjsarticle
% =============================================================================
\documentclass[a4paper,11pt]{ltjsarticle}

% --- Core packages ---
\usepackage{luatexja-fontspec}
\usepackage{amsmath,amssymb,amsthm}
\usepackage{mathtools}
\usepackage{tikz-cd}
\usepackage{tikz}
\usetikzlibrary{arrows.meta,positioning,calc,shapes.geometric,decorations.pathmorphing,cd}
\usepackage{enumitem}
\usepackage{hyperref}
\usepackage{tcolorbox}
\tcbuselibrary{skins,breakable}
\usepackage{listings}
\usepackage{xcolor}
\usepackage{geometry}
\usepackage{fancyhdr}
\usepackage{float}
\usepackage{booktabs}
\usepackage{array}
\usepackage{caption}

% --- Page geometry ---
\geometry{margin=2.5cm, top=3cm, bottom=3cm}

% --- Fonts ---
\setmainjfont{Harano Aji Mincho}[
  BoldFont = Harano Aji Mincho,
  BoldFeatures = {FakeBold=2},
]
\setsansjfont{Harano Aji Gothic}
\setmonofont[Scale=0.85]{DejaVu Sans Mono}

% --- Colors ---
\definecolor{leanblue}{HTML}{2563EB}
\definecolor{leanbg}{HTML}{F8FAFC}
\definecolor{leancomment}{HTML}{6B7280}
\definecolor{leankeyword}{HTML}{7C3AED}
\definecolor{leanstring}{HTML}{059669}
\definecolor{accentcolor}{HTML}{1E40AF}
\definecolor{theoremcolor}{HTML}{EFF6FF}
\definecolor{definitioncolor}{HTML}{F0FDF4}
\definecolor{remarkcolor}{HTML}{FFF7ED}
\definecolor{warningcolor}{HTML}{FEF3C7}
\definecolor{completioncolor}{HTML}{F0F9FF}
\definecolor{cauchycolor}{HTML}{FDF4FF}

% --- Hyperref ---
\hypersetup{
  colorlinks=true,
  linkcolor=accentcolor,
  urlcolor=leanblue,
  citecolor=accentcolor,
  pdftitle={Structure Tower ç™ºå±•æ¼”ç¿’ Level 6},
  pdfauthor={su},
}

% --- Theorem environments ---
\theoremstyle{definition}
\newtheorem{definition}{å®šç¾©}[section]
\newtheorem{example}[definition]{ä¾‹}
\newtheorem{construction}[definition]{æ§‹æˆ}

\theoremstyle{plain}
\newtheorem{theorem}[definition]{å®šç†}
\newtheorem{lemma}[definition]{è£œé¡Œ}
\newtheorem{proposition}[definition]{å‘½é¡Œ}
\newtheorem{corollary}[definition]{ç³»}

\theoremstyle{remark}
\newtheorem{remark}[definition]{æ³¨æ„}

% --- Lean code listing environment ---
\lstdefinelanguage{lean4}{
  morekeywords={def,theorem,lemma,example,instance,class,structure,
    where,let,in,do,if,then,else,match,with,fun,return,
    import,open,namespace,section,end,variable,
    inductive,abbrev,noncomputable,private,protected,
    sorry,admit,have,show,suffices,calc,by,exact,
    apply,intro,intros,constructor,cases,induction,
    simp,rw,rfl,ext,ring,linarith,omega,norm_num,
    decide,trivial,assumption,contradiction,
    Type,Prop,Sort,Set,true,false,
    attribute,deriving},
  sensitive=true,
  morecomment=[l]{--},
  morecomment=[n]{/-}{-/},
  morestring=[b]",
  literate=
    {->}{{\(\to\)}}2
    {<-}{{\(\leftarrow\)}}2
    {<->}{{\(\leftrightarrow\)}}3
    {<=}{{\(\leq\)}}2
    {>=}{{\(\geq\)}}2
    {:=}{{:=}}2
    {=>}{{\(\Rightarrow\)}}2,
}

\lstnewenvironment{leancode}[1][]{%
  \lstset{
    language=lean4,
    basicstyle=\ttfamily\footnotesize,
    keywordstyle=\color{leankeyword}\bfseries,
    commentstyle=\color{leancomment}\itshape,
    stringstyle=\color{leanstring},
    backgroundcolor=\color{leanbg},
    frame=single,
    rulecolor=\color{leanblue!30},
    framesep=8pt,
    xleftmargin=12pt,
    xrightmargin=12pt,
    breaklines=true,
    breakatwhitespace=true,
    showstringspaces=false,
    tabsize=2,
    captionpos=b,
    numbers=left,
    numberstyle=\tiny\color{leancomment},
    numbersep=8pt,
    aboveskip=1em,
    belowskip=1em,
    inputencoding=utf8,
    extendedchars=true,
    #1
  }%
}{}

% --- Tcolorbox styles ---
\newtcolorbox{proofstrategy}{
  colback=remarkcolor,
  colframe=orange!60!black,
  title={\textbf{è¨¼æ˜æˆ¦ç•¥}},
  fonttitle=\sffamily,
  boxrule=0.5pt,
  arc=3pt,
}

\newtcolorbox{mathinsight}{
  colback=theoremcolor,
  colframe=accentcolor,
  title={\textbf{æ•°å­¦çš„æ´å¯Ÿ}},
  fonttitle=\sffamily,
  boxrule=0.5pt,
  arc=3pt,
}

\newtcolorbox{completionbox}{
  colback=completioncolor,
  colframe=leanblue,
  title={\textbf{å®Œå‚™åŒ–ã®æ¦‚å¿µ}},
  fonttitle=\sffamily,
  boxrule=0.5pt,
  arc=3pt,
}

\newtcolorbox{levelguide}{
  colback=cauchycolor,
  colframe=leankeyword!70!black,
  title={\textbf{æ¼”ç¿’ãƒ¬ãƒ™ãƒ«æŒ‡é‡}},
  fonttitle=\sffamily,
  boxrule=0.5pt,
  arc=3pt,
}

% --- Header/Footer ---
\pagestyle{fancy}
\fancyhf{}
\renewcommand{\headrulewidth}{0.4pt}
\fancyhead[L]{\small\sffamily\nouppercase{\leftmark}}
\fancyhead[R]{\small\sffamily Structure Tower Level 6}
\fancyfoot[C]{\thepage}

% --- Math macros ---
\newcommand{\Rhat}{\widehat{R}}
\newcommand{\Ihat}{\widehat{I}}
\newcommand{\NatD}{\mathbb{N}^{\mathrm{op}}}

% =============================================================================
\begin{document}

% --- Title ---
\title{%
  {\LARGE\sffamily\bfseries Structure Tower ç™ºå±•æ¼”ç¿’ Level 6}\\[0.5em]
  {\large\sffamily $I$-adic å®Œå‚™åŒ–ã¨ StructureTowerï¼š\\
  Cauchy åˆ—ãƒ»null åˆ—ãƒ»æ™®éæ€§ãƒ»ClosedTower}\\[0.3em]
  {\normalsize\sffamily Lean 4 / Mathlib4 ã«ã‚ˆã‚‹å½¢å¼åŒ–ã¨ãã®æ•°å­¦çš„è§£èª¬}%
}
\author{su}
\date{\today}
\maketitle

% --- AI Disclosure ---
\begin{center}
\small
\textit{AI assistance disclosure:}\\
Lean ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã¯ Claude (Anthropic) ã§éª¨æ ¼ã‚’ç”Ÿæˆã—ã€
Codex (OpenAI) ã§ä¿®æ­£ã—ãŸã€‚\\
\TeX\ æ–‡æ›¸ã¯ Claude Code (Anthropic) ã§ç”Ÿæˆã—ãŸã€‚\\
è‘—è€…ã«ã‚ˆã‚‹åŠ ç­†ãƒ»ä¿®æ­£ã¯è¡Œã£ã¦ã„ãªã„ã€‚\\
å†…å®¹ã®æ­£ç¢ºæ€§ã¯ä¿è¨¼ã•ã‚Œãšã€èª¤ã‚ŠãŒã‚ã‚Œã°è‘—è€…ã®è²¬ä»»ã§ã‚ã‚‹ã€‚
\end{center}

\vspace{1em}

% --- Abstract ---
\begin{abstract}
æœ¬ç¨¿ã¯ Lean 4 / Mathlib4 ã‚’ç”¨ã„ãŸ Structure Tower å½¢å¼åŒ–ã‚·ãƒªãƒ¼ã‚ºã® Level 6 ã¨ã—ã¦ï¼Œ
$I$-adic å®Œå‚™åŒ–ã‚’ \texttt{StructureTower} ã®è¨€èªã§è¨˜è¿°ã—ãŸæ¼”ç¿’ãƒ•ã‚¡ã‚¤ãƒ«ã®æ•°å­¦çš„è§£èª¬ã§ã‚ã‚‹ï¼
Level 1--5 ã§æ§‹ç¯‰ã—ãŸ \texttt{idealPowTower}ï¼Œ\texttt{ClosedTower}ï¼Œ\texttt{ringHom\_towerHom}
ãªã©ã®æ çµ„ã¿ã‚’å…¨ã¦çµ±åˆã—ï¼Œ
\begin{enumerate}
  \item \textbf{Cauchy åˆ—ã®å¡”çš„å®šç¾©}ï¼š$({\mathbb{N}} \to R)$ ä¸Šã® \texttt{StructureTower} ã¨ã—ã¦ Cauchy åˆ—ã®ã€Œé€Ÿã•ã€ã‚’éšå±¤åŒ–ã™ã‚‹ï¼›
  \item \textbf{null åˆ—ã¨ I-adic Setoid}ï¼šnull åˆ—ã®ä»£æ•°çš„é–‰æ€§ã¨ï¼Œåˆ†é›¢æ¡ä»¶ä¸‹ã§ã®å®šæ•° null åˆ—ã®ç‰¹å¾´ä»˜ã‘ï¼›
  \item \textbf{å®Œå‚™åŒ–ã®æ™®éæ€§}ï¼š\texttt{AdicCompletion} ã«ã‚ˆã‚‹ $\widehat{R}$ ã®æ§‹æˆã¨ï¼ŒåŸ‹ã‚è¾¼ã¿ $\iota\colon R \to \widehat{R}$ ãŒèª˜å°ã™ã‚‹å¡”æº–åŒå‹ï¼›
  \item \textbf{å®Œå‚™å¡”ã¨ ClosedTower}ï¼š$\widehat{R}$ ä¸Šã®å†ªå¡”ãŒ \texttt{ClosedTower} ã‹ã¤è‡ªå‹•çš„ã«åˆ†é›¢çš„ã§ã‚ã‚‹ã“ã¨ï¼›
\end{enumerate}
ã‚’æ®µéšçš„ã«è«–ã˜ã‚‹ï¼Bourbaki ã®æ¯æ§‹é€ è«–çš„ãªè¦–ç‚¹â€”â€”é †åºæ§‹é€ ãƒ»ä»£æ•°æ§‹é€ ãƒ»ä½ç›¸æ§‹é€ ã®ä¸‰ä½ä¸€ä½“â€”â€”ãŒä¸€ã¤ã®å½¢å¼çš„æ§‹æˆã«åæŸã™ã‚‹éç¨‹ã‚’è¿½ã†ï¼
\end{abstract}

\tableofcontents
\newpage

% =============================================================================
\section{å°å…¥ï¼šBourbaki ã®å®Œå‚™åŒ–ã¨ãã®å¡”çš„è§£é‡ˆ}
% =============================================================================

\subsection{Level 6 ã®å‹•æ©Ÿ}

Level 5 ã§ã¯ï¼Œå¯æ›ç’° $R$ ã¨ãã®ã‚¤ãƒ‡ã‚¢ãƒ« $I$ ã«å¯¾ã—ã¦
\[
  \texttt{idealPowTower}(I)\colon \texttt{StructureTower}\; \mathbb{N}^{\mathrm{op}}\; R,
  \quad \texttt{level}(n) = I^n
\]
ã¨ã„ã† canonical ãªä¾‹ã‚’æ§‹æˆã—ï¼ŒL1--L4 ã®å…¨æ§‹é€ ãŒã“ã®ä¸€ä¾‹ã«åˆæµã™ã‚‹ã“ã¨ã‚’ç¢ºèªã—ãŸï¼

Level 6 ã®ç›®æ¨™ã¯ãã®å…ˆã«ã‚ã‚‹ï¼š\textbf{$I$-adic å®Œå‚™åŒ–}ã‚’ \texttt{StructureTower} ã®è¨€èªã§è¨˜è¿°ã™ã‚‹ã“ã¨ã§ã‚ã‚‹ï¼
å…·ä½“çš„ã«ã¯ï¼Œ
\[
  \text{Cauchy åˆ—} \;\to\; \text{null åˆ—} \;\to\; \text{å•†ç’°} \;\to\; \text{å®Œå‚™åŒ–ã®æ™®éæ€§} \;\to\; \text{ClosedTower}
\]
ã¨ã„ã†å¯æ›ç’°è«–ã®ä¸­æ ¸ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚’æ®µéšçš„ã«å½¢å¼åŒ–ã™ã‚‹ï¼

\subsection{Bourbaki ã®ç²¾ç¥}

$I$-adic å®Œå‚™åŒ–ã¯ Bourbaki ã®æ¯æ§‹é€ ã®ç²¾ç¥ã«å¿ å®Ÿãªä¾‹ã§ã‚ã‚‹ï¼š

\begin{center}
\begin{tikzpicture}[
  box/.style={draw, rounded corners=4pt, fill=theoremcolor, minimum width=3.5cm, minimum height=1cm, align=center, font=\small},
  arrow/.style={-Stealth, thick, leanblue},
]
  \node[box, fill=definitioncolor] (ord) at (0,0) {é †åºæ§‹é€ \\$\mathbb{N}^{\mathrm{op}}$ æ·»å­—ã®å¡”};
  \node[box, fill=remarkcolor] (alg) at (5,0) {ä»£æ•°æ§‹é€ \\ç’°ã® Cauchy åˆ—};
  \node[box, fill=completioncolor] (top) at (2.5,-2.5) {ä½ç›¸æ§‹é€ \\$I$-adic ä½ç›¸ã®å®Œå‚™æ€§};
  \node[box, fill=cauchycolor, minimum width=4cm] (comp) at (2.5,-5) {\textbf{$I$-adic å®Œå‚™åŒ–}\\$\widehat{R} = \varprojlim R/I^n$};
  \draw[arrow] (ord) -- (comp);
  \draw[arrow] (alg) -- (comp);
  \draw[arrow] (top) -- (comp);
  \node at (2.5, -3.8) {\footnotesize ä¸‰ã¤ã®æ§‹é€ ãŒçµ±åˆã•ã‚Œã‚‹};
\end{tikzpicture}
\end{center}

\begin{mathinsight}
Level 6 ã®æ ¸å¿ƒçš„æ´å¯Ÿï¼šCauchy åˆ—ã®ã€Œé€Ÿã•ã€ã‚’ \texttt{StructureTower} ã®ãƒ¬ãƒ™ãƒ«ã¨ã—ã¦æ‰ãˆã‚‹ï¼
\[
  \texttt{level}(k) = \bigl\{x\colon \mathbb{N} \to R \;\big|\; \forall m,n,\; x_m - x_n \in I^{\min(m,n)+k}\bigr\}
\]
$k$ ãŒå¤§ãã„ã»ã©æ¡ä»¶ãŒå³ã—ã„ï¼ˆã€Œé€Ÿã„ã€Cauchy åˆ—ï¼‰ï¼
$\mathbb{N}^{\mathrm{op}}$ ã§æ·»å­—åŒ–ã™ã‚‹ã¨æ¸›å°‘æ— $\to$ å¢—åŠ æ— ã¨ãªã‚Šï¼Œ
ã“ã‚Œã¯ \texttt{idealPowTower} ã¨åŒã˜ $\mathbb{N}^{\mathrm{op}}$ ãƒ‘ã‚¿ãƒ¼ãƒ³ã§ã‚ã‚‹ï¼
\end{mathinsight}

\subsection{Level 6 ã®å…¨ä½“æ§‹æˆ}

\begin{levelguide}
é›£æ˜“åº¦ãƒãƒ¼ã‚¯ï¼š
\begin{itemize}[leftmargin=2em]
  \item[$\bullet$] \textbf{ğŸŸ¢ ç·‘}ï¼šç›´æ¥çš„ãªå®šç¾©å±•é–‹ãƒ»å®šç¾©ã®çµ„ã¿åˆã‚ã›
  \item[$\bullet$] \textbf{ğŸŸ¡ é»„}ï¼šè£œé¡Œã®é¸æŠã¨çµåˆãŒå¿…è¦
  \item[$\bullet$] \textbf{ğŸ”´ èµ¤}ï¼šè¤‡æ•°ã®æ¦‚å¿µã‚’çµ±åˆã—ãŸæœ¬è³ªçš„ãªæ¨è«–
\end{itemize}
\end{levelguide}

\begin{center}
\begin{tikzcd}[column sep=large, row sep=large]
  \texttt{cauchySeqTower}(I) \ar[r, "\text{Â§L6-1}"]
  & \texttt{IsIAdicNull} \ar[r, "\text{Â§L6-2}"]
  & \texttt{iadicSetoid} \ar[d, "\text{å•†ç’°}"] \\
  \texttt{ClosedTower}(\hat{R}) \ar[u, "\text{Â§L6-4}"']
  & \texttt{Hom(towerHom)} \ar[l, "\text{Â§L6-4}"']
  & \widehat{R} \ar[l, "\iota\text{: Â§L6-3}"]
\end{tikzcd}
\captionof{figure}{Level 6 ã®æ¦‚å¿µé–“ã®é–¢ä¿‚}
\end{center}

% =============================================================================
\section{\S L6-1ï¼šCauchy åˆ—ã®å¡”çš„å®šç¾©}
% =============================================================================

\subsection{$I$-adic Cauchy åˆ—}

\subsubsection{å¤å…¸çš„å®šç¾©ã¨å¡”çš„å®šç¾©ã®æ¯”è¼ƒ}

$I$-adic Cauchy åˆ—ã®å¤å…¸çš„å®šç¾©ã¯æ¬¡ã®ã¨ãŠã‚Šã§ã‚ã‚‹ï¼š

\begin{definition}[$I$-adic Cauchy åˆ—ï¼ˆå¤å…¸å‹ï¼‰]
åˆ— $x\colon \mathbb{N} \to R$ ãŒ \textbf{$I$-adic Cauchy} ã§ã‚ã‚‹ã¨ã¯ï¼Œ
\[
  \forall k \in \mathbb{N},\; \exists N \in \mathbb{N},\; \forall m,n \ge N,\; x_m - x_n \in I^k
\]
ãŒæˆã‚Šç«‹ã¤ã“ã¨ã‚’ã„ã†ï¼
\end{definition}

ä¸€æ–¹ï¼ŒLean ã®å½¢å¼åŒ–ã§ã¯ã€Œä¸€æ§˜å‹ã€ã‚’æ¡ç”¨ã™ã‚‹ï¼š

\begin{definition}[$I$-adic Cauchy åˆ—ï¼ˆä¸€æ§˜å‹ï¼ŒLean ç‰ˆï¼‰]
åˆ— $x\colon \mathbb{N} \to R$ ãŒ \textbf{$I$-adic Cauchyï¼ˆä¸€æ§˜å‹ï¼‰} ã§ã‚ã‚‹ã¨ã¯ï¼Œ
\[
  \forall m,n \in \mathbb{N},\; x_m - x_n \in I^{\min(m,n)}
\]
ãŒæˆã‚Šç«‹ã¤ã“ã¨ã‚’ã„ã†ï¼ˆ\texttt{IsIAdicCauchy} ã«å¯¾å¿œï¼‰ï¼
\end{definition}

\begin{remark}
ä¸€æ§˜å‹ã¯ã€Œ$m$ ç•ªç›®ã¨ $n$ ç•ªç›®ã®å·®ã¯ $I^{\min(m,n)}$ ã«å…¥ã‚‹ã€ã¨ã„ã†æ¡ä»¶ã§ã‚ã‚Šï¼Œ
å¤å…¸å‹ã® $k=0$ ç›¸å½“ã«å¯¾å¿œã™ã‚‹ï¼
ã“ã‚Œã¯ \texttt{cauchySeqTower} ã®ãƒ¬ãƒ™ãƒ« $0$ ã«å¯¾å¿œã™ã‚‹ï¼
\end{remark}

\subsubsection{Cauchy åˆ—ã®å¡”æ§‹æˆ}

\begin{construction}[\texttt{cauchySeqTower}]\label{constr:cauchyseq}
$R$ ã‚’å¯æ›ç’°ï¼Œ$I \subseteq R$ ã‚’ã‚¤ãƒ‡ã‚¢ãƒ«ã¨ã™ã‚‹ï¼
é–¢æ•°ç©ºé–“ $(\mathbb{N} \to R)$ ä¸Šã®æ§‹é€ å¡”
\[
  \texttt{cauchySeqTower}(I)\colon \texttt{StructureTower}\; \mathbb{N}^{\mathrm{op}}\; (\mathbb{N} \to R)
\]
ã‚’æ¬¡ã§å®šç¾©ã™ã‚‹ï¼š
\[
  \texttt{level}(k) = \bigl\{x\colon \mathbb{N} \to R \;\big|\; \forall m,n \in \mathbb{N},\; x_m - x_n \in I^{\min(m,n) + k}\bigr\}
\]
ã“ã“ã§ $k \in \mathbb{N}^{\mathrm{op}}$ ã¯ã€Œé€Ÿã•ã€ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã§ã‚ã‚‹ï¼
\end{construction}

\begin{figure}[H]
\centering
\begin{tikzpicture}[
  level/.style={draw, rounded corners=3pt, minimum width=6cm, minimum height=0.7cm,
                fill=cauchycolor, font=\small, align=center},
  arrow/.style={-Stealth, gray!70, thick},
]
  \node[level, fill=leanbg!80] (k0) at (0, 0) {level $0$: $x_m - x_n \in I^{\min(m,n)}$ï¼ˆä¸€èˆ¬ Cauchy åˆ—ï¼‰};
  \node[level] (k1) at (0, -1.4) {level $1$: $x_m - x_n \in I^{\min(m,n)+1}$ï¼ˆã‚ˆã‚Šé€Ÿã„ï¼‰};
  \node[level] (k2) at (0, -2.8) {level $2$: $x_m - x_n \in I^{\min(m,n)+2}$ï¼ˆã•ã‚‰ã«é€Ÿã„ï¼‰};
  \node[font=\large] (dots) at (0, -3.9) {$\vdots$};
  \node[level, fill=remarkcolor] (kinf) at (0, -5.1) {level $k$: $x_m - x_n \in I^{\min(m,n)+k}$ï¼ˆ$k$ ãŒå¤§ãã„ã»ã©å³ã—ã„ï¼‰};
  \draw[arrow] (k0.south) -- (k1.north) node[midway, right, font=\small] {$\subseteq$};
  \draw[arrow] (k1.south) -- (k2.north) node[midway, right, font=\small] {$\subseteq$};
\end{tikzpicture}
\caption{Cauchy åˆ—ã®å¡”ï¼š$k$ ãŒå¤§ãã„ã»ã©ã€Œé€Ÿã„ã€Cauchy åˆ—ã®ã¿ã‚’å«ã‚€ï¼ˆ$\mathbb{N}^{\mathrm{op}}$ æ·»å­—ã§åŒ…å«é–¢ä¿‚ãŒå¢—åŠ çš„ï¼‰}
\end{figure}

\begin{proposition}[\texttt{cauchySeqTower} ã®å˜èª¿æ€§]\label{prop:cauchy-mono}
$i \le j$ in $\mathbb{N}^{\mathrm{op}}$ ãªã‚‰ã° $\texttt{level}(i) \subseteq \texttt{level}(j)$ï¼
\end{proposition}

\begin{proof}
$i \le j$ in $\mathbb{N}^{\mathrm{op}}$ ã¨ã¯ $j^* \le i^*$ in $\mathbb{N}$ï¼ˆãŸã ã— $*$ ã¯ \texttt{ofDual}ï¼‰ã‚’æ„å‘³ã™ã‚‹ï¼
$x \in \texttt{level}(i)$ ã¨ã™ã‚‹ï¼Œã™ãªã‚ã¡ä»»æ„ã® $m,n$ ã«å¯¾ã—ã¦ $x_m - x_n \in I^{\min(m,n)+i^*}$ï¼
$j^* \le i^*$ ã‚ˆã‚Š $\min(m,n)+j^* \le \min(m,n)+i^*$ï¼Œ
ã‚†ãˆã« $I^{\min(m,n)+i^*} \subseteq I^{\min(m,n)+j^*}$ï¼ˆã‚¤ãƒ‡ã‚¢ãƒ«ã®å†ªã®å˜èª¿æ€§ï¼‰ï¼
ã‚ˆã£ã¦ $x_m - x_n \in I^{\min(m,n)+j^*}$ï¼Œã™ãªã‚ã¡ $x \in \texttt{level}(j)$ï¼
\end{proof}

\subsubsection{ä»£æ•°çš„é–‰æ€§}

Cauchy åˆ—ã®å¡”ã«ã¯è‡ªç„¶ãªä»£æ•°æ§‹é€ ãŒå…¥ã‚‹ï¼š

\begin{proposition}[å®šæ•°åˆ—ã®å¸°å±]
ä»»æ„ã® $r \in R$ ãŠã‚ˆã³ $k \in \mathbb{N}^{\mathrm{op}}$ ã«å¯¾ã—ã¦ï¼Œ
å®šæ•°åˆ— $\overline{r} = (r, r, r, \ldots)$ ã¯ $\texttt{level}(k)$ ã«å±ã™ã‚‹ï¼
\end{proposition}

\begin{proof}
$\overline{r}_m - \overline{r}_n = r - r = 0 \in I^{\min(m,n)+k}$ ã‚ˆã‚Šæ˜ã‚‰ã‹ï¼ˆ$0$ ã¯ä»»æ„ã®ã‚¤ãƒ‡ã‚¢ãƒ«ã®å…ƒï¼‰ï¼
\end{proof}

\begin{proposition}[åŠ æ³•çš„é–‰æ€§]
$x, y \in \texttt{level}(k)$ ãªã‚‰ã° $x + y \in \texttt{level}(k)$ï¼
\end{proposition}

\begin{proof}
$(x+y)_m - (x+y)_n = (x_m - x_n) + (y_m - y_n)$ï¼
$x_m - x_n,\, y_m - y_n \in I^{\min(m,n)+k}$ ãªã®ã§ï¼Œ
\texttt{Ideal.add\_mem} ã‚ˆã‚Š $(x_m - x_n) + (y_m - y_n) \in I^{\min(m,n)+k}$ï¼
\end{proof}

\begin{proposition}[ã‚¹ã‚«ãƒ©ãƒ¼å€ã®é–‰æ€§]
$r \in R$ï¼Œ$x \in \texttt{level}(k)$ ãªã‚‰ã° $(n \mapsto r \cdot x_n) \in \texttt{level}(k)$ï¼
\end{proposition}

\begin{proof}
$r \cdot x_m - r \cdot x_n = r \cdot (x_m - x_n)$ï¼
$x_m - x_n \in I^{\min(m,n)+k}$ ãªã®ã§ï¼Œ
$I^k$ ã¯ $R$-åŠ ç¾¤ã§ã‚ã‚‹ã‹ã‚‰ $r \cdot (x_m - x_n) \in I^{\min(m,n)+k}$ï¼
\end{proof}

\begin{remark}
ã“ã‚Œã‚‰ä¸‰ã¤ã®å‘½é¡Œã¯ï¼Œ\texttt{cauchySeqTower} ãŒ \textbf{ãƒ•ã‚£ãƒ«ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ $R$-åŠ ç¾¤}ã®æ§‹é€ ã‚’æŒã¤ã“ã¨ã‚’ç¤ºã—ã¦ã„ã‚‹ï¼
Level 5 ã§ç¢ºèªã—ãŸä¹—æ³•äº’æ›æ€§ï¼ˆ\texttt{cauchySeqTower\_mul\_mem}ï¼‰ã®åŠ æ³•ãƒ»ã‚¹ã‚«ãƒ©ãƒ¼ç‰ˆã«å¯¾å¿œã™ã‚‹ï¼
\end{remark}

\begin{leancode}[caption={L6-1: Cauchy åˆ—ã®å¡”å®šç¾©}]
-- L6-1b: Cauchy åˆ—ã®å¡”
def cauchySeqTower : StructureTower Nod (N -> R) where
  level k := {x : N -> R | forall m n, x m - x n in I ^ (min m n + ofDual k)}
  monotone_level := by
    intro i j hij x hx m n
    exact Ideal.pow_le_pow_right
      (Nat.add_le_add_left (OrderDual.ofDual_le_ofDual.mpr hij) _) (hx m n)

-- L6-1c: level 0 ã¨ IsIAdicCauchy ã®ä¸€è‡´
theorem cauchySeqTower_level_zero :
    (cauchySeqTower I).level (OrderDual.toDual 0) =
      {x : N -> R | IsIAdicCauchy I x} := by
  ext x; simp [cauchySeqTower, IsIAdicCauchy]
\end{leancode}

% =============================================================================
\section{\S L6-2ï¼šnull åˆ—ã¨åŒå€¤é–¢ä¿‚}
% =============================================================================

\subsection{$I$-adic null åˆ—}

\begin{definition}[$I$-adic null åˆ—]
åˆ— $x\colon \mathbb{N} \to R$ ãŒ \textbf{$I$-adic null} ã§ã‚ã‚‹ã¨ã¯ï¼Œ
\[
  \forall k \in \mathbb{N},\; \exists N \in \mathbb{N},\; \forall n \ge N,\; x_n \in I^k
\]
ãŒæˆã‚Šç«‹ã¤ã“ã¨ã‚’ã„ã†ï¼ã™ãªã‚ã¡ï¼Œ$x_n$ ãŒ $I$-adic ä½ç›¸ã§ $0$ ã«åæŸã™ã‚‹ï¼
\end{definition}

\begin{remark}
null åˆ—ã¨ \texttt{cauchySeqTower} ã® \texttt{global} ã®å¯¾æ¯”ï¼š
\begin{align*}
  \texttt{global}(T) &= \bigcap_{k} \texttt{level}(k) = \{x \mid \forall k,\, \forall m,n,\, x_m - x_n \in I^k\} \\
  \text{null åˆ—} &= \{x \mid \forall k,\, \exists N,\, \forall n \ge N,\, x_n \in I^k\}
\end{align*}
null åˆ—ã¯ã€Œã™ã¹ã¦ã®ãƒ¬ãƒ™ãƒ«ã« \emph{eventually} å±ã™ã‚‹åˆ—ã€ï¼Œ
global ã¯ã€Œã™ã¹ã¦ã®ãƒ¬ãƒ™ãƒ«ã« \emph{å¸¸ã«} å±ã™ã‚‹åˆ—ã€ã§ã‚ã‚‹ï¼
\end{remark}

\subsection{null åˆ—ã®ä»£æ•°çš„é–‰æ€§}

\begin{proposition}
æ¬¡ãŒæˆã‚Šç«‹ã¤ï¼š
\begin{enumerate}
  \item é›¶åˆ— $0$ ã¯ null åˆ—ã§ã‚ã‚‹ï¼
  \item $x, y$ ãŒ null ãªã‚‰ã° $x + y$ ã‚‚ null ã§ã‚ã‚‹ï¼
  \item $x$ ãŒ null ãªã‚‰ã° $-x$ ã‚‚ null ã§ã‚ã‚‹ï¼
\end{enumerate}
\end{proposition}

\begin{proof}
\begin{enumerate}
  \item $0_n = 0 \in I^k$ for all $n, k$ï¼$N = 0$ ã§ OKï¼
  \item å„ $k$ ã«å¯¾ã— $x, y$ ã®ãã‚Œãã‚Œã‹ã‚‰ $N_x, N_y$ ã‚’å–ã‚Šï¼Œ$N = \max(N_x, N_y)$ ã¨ãŠãï¼
    $n \ge N$ ãªã‚‰ã° $(x+y)_n = x_n + y_n \in I^k + I^k \subseteq I^k$ï¼ˆ\texttt{Ideal.add\_mem}ï¼‰ï¼
  \item $I^k$ ã¯ã‚¤ãƒ‡ã‚¢ãƒ«ãªã®ã§ $-a \in I^k \iff a \in I^k$ï¼
\end{enumerate}
\end{proof}

\subsection{$I$-adic Setoid}

\begin{construction}[$I$-adic Setoid]
$({\mathbb{N}} \to R)$ ä¸Šã®åŒå€¤é–¢ä¿‚ã‚’
\[
  x \sim y \;\iff\; x - y \text{ ãŒ null åˆ—}
\]
ã¨å®šç¾©ã™ã‚‹ï¼ã“ã‚Œã¯ç¢ºã‹ã«åŒå€¤é–¢ä¿‚ã§ã‚ã‚‹ï¼š
\begin{center}
\begin{tikzpicture}[
  node/.style={draw, rounded corners=3pt, fill=theoremcolor, font=\small, align=center, minimum width=3cm, minimum height=0.9cm},
  arrow/.style={-Stealth, thick},
]
  \node[node] (refl) at (0,0) {\textbf{åå°„æ€§}\\$x - x = 0$ ã¯ null};
  \node[node] (symm) at (5,0) {\textbf{å¯¾ç§°æ€§}\\$y - x = -(x-y)$ ã¯ null};
  \node[node] (trans) at (2.5,-2) {\textbf{æ¨ç§»æ€§}\\$x - z = (x-y)+(y-z)$ ã¯ null};
  \draw[arrow] (refl) -- (trans);
  \draw[arrow] (symm) -- (trans);
\end{tikzpicture}
\end{center}
\end{construction}

\begin{leancode}[caption={L6-2e: I-adic Setoid ã®æ§‹æˆ}]
def iadicSetoid : Setoid (N -> R) where
  r x y := IsIAdicNull I (x - y)
  iseqv := {
    refl := fun x => by simp [isIAdicNull_zero I]
    symm := fun {x y} hxy => by
      have : y - x = -(x - y) := by ring
      rw [this]; exact isIAdicNull_neg I hxy
    trans := fun {x y z} hxy hyz => by
      have : x - z = (x - y) + (y - z) := by ring
      rw [this]; exact isIAdicNull_add I hxy hyz
  }
\end{leancode}

\subsection{åˆ†é›¢æ¡ä»¶ã¨ null å®šæ•°åˆ—}

\begin{theorem}[åˆ†é›¢æ¡ä»¶ã¨ null å®šæ•°åˆ—ã®å¯¾å¿œ]\label{thm:separated-null}
$I$ ãŒ \textbf{åˆ†é›¢çš„}ï¼ˆ$\bigcap_{n} I^n = 0$ï¼‰ã§ã‚ã‚‹ã¨ãï¼Œ
å®šæ•°åˆ— $(r, r, r, \ldots)$ ãŒ null åˆ—ã§ã‚ã‚‹ã“ã¨ã¨ $r = 0$ ã¯åŒå€¤ã§ã‚ã‚‹ï¼š
\[
  \texttt{IsSeparated}(I) \implies
  \bigl[\text{const}(r) \text{ ã¯ null}\bigr] \iff r = 0.
\]
\end{theorem}

\begin{proof}
($\Rightarrow$) $r \neq 0$ ã¨ä»®å®šã™ã‚‹ï¼åˆ†é›¢æ¡ä»¶ã‚ˆã‚Š Level 5 ã®è„±å‡ºå®šç†ï¼ˆ\texttt{escape\_of\_isSeparated}ï¼‰ãŒä½¿ãˆï¼Œ
$r \notin I^n$ ã¨ãªã‚‹ $n$ ãŒå­˜åœ¨ã™ã‚‹ï¼ã—ã‹ã— const$(r)$ ãŒ null ãªã‚‰ã°ï¼Œãã®ã‚ˆã†ãª $n$ ã«å¯¾ã—ã¦
$\exists N,\, r \in I^n$ ã¨ãªã‚ŠçŸ›ç›¾ã™ã‚‹ï¼

($\Leftarrow$) $r = 0$ ãªã‚‰ã°ï¼Œå®šæ•°åˆ—ã¯ã‚¼ãƒ­åˆ—ã ã‹ã‚‰ null ã§ã‚ã‚‹ï¼
\end{proof}

\begin{mathinsight}
å®šç† \ref{thm:separated-null} ã¯ã€Œ\textbf{åˆ†é›¢çš„} $\iff$ $I$-adic ä½ç›¸ãŒ $T_1$ $\iff$ å®šæ•° null åˆ—ã¯é›¶åˆ—ã®ã¿ã€ã¨ã„ã†ç­‰ä¾¡æ€§ã®å½¢å¼åŒ–ã§ã‚ã‚‹ï¼
ã“ã‚Œã¯å¾Œã® $\iota\colon R \to \widehat{R}$ ã®å˜å°„æ€§ã®æ ¹æ‹ ã¨ãªã‚‹ï¼
\end{mathinsight}

% =============================================================================
\section{\S L6-3ï¼šå®Œå‚™åŒ–ã®æ™®éæ€§}
% =============================================================================

\subsection{Mathlib ã® $I$-adic å®Œå‚™åŒ–}

Lean / Mathlib ã§ã¯ï¼Œ$I$-adic å®Œå‚™åŒ–ã¯æ¬¡ã§ä¸ãˆã‚‰ã‚Œã‚‹ï¼š
\[
  \widehat{R} := \texttt{AdicCompletion}\, I\, R = \varprojlim_{n} R/I^n,
  \quad
  \iota := \texttt{algebraMap}\; R\; \widehat{R}\colon R \to \widehat{R}.
\]

\begin{construction}[å®Œå‚™åŒ–å¡” \texttt{completionPowTower}]
$\widehat{R}$ ä¸Šã®ã‚¤ãƒ‡ã‚¢ãƒ« $\hat{I} := \iota(I) \cdot \widehat{R}$ ã«å¯¾ã—ã¦ï¼Œ
\[
  \texttt{completionPowTower}(I) := \texttt{idealPowTower}(\hat{I})\colon
  \texttt{StructureTower}\; \mathbb{N}^{\mathrm{op}}\; \widehat{R}
\]
ã‚’ Level 5 ã® \texttt{idealPowTower} ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ãã®ã¾ã¾ $\widehat{R}$ ã«é©ç”¨ã—ã¦æ§‹æˆã™ã‚‹ï¼
\end{construction}

\subsection{åŸ‹ã‚è¾¼ã¿ $\iota$ ãŒèª˜å°ã™ã‚‹å¡”æº–åŒå‹}

\begin{theorem}[å¡”æº–åŒå‹ã®èª˜å°]\label{thm:tower-hom}
åŸ‹ã‚è¾¼ã¿ $\iota\colon R \to \widehat{R}$ ã¯ï¼Œ
\texttt{StructureTower} ã®æº–åŒå‹
\[
  \texttt{completion\_towerHom}(I)\colon \texttt{idealPowTower}(I) \to \texttt{completionPowTower}(I)
\]
ã‚’èª˜å°ã™ã‚‹ï¼
\end{theorem}

\begin{proof}
Level 5 ã§ç¢ºç«‹ã—ãŸ \texttt{ringHom\_towerHom} ã® canonical ãªé©ç”¨ã§ã‚ã‚‹ï¼š
$\phi = \iota$ï¼Œ$J = \hat{I}$ï¼Œæ¡ä»¶ $\hat{I} \le \hat{I}$ï¼ˆæ’ç­‰çš„ï¼‰ã‚ˆã‚Šç›´ã¡ã«å¾“ã†ï¼
\end{proof}

\begin{figure}[H]
\centering
\begin{tikzcd}[column sep=5em, row sep=4em]
  \texttt{idealPowTower}(I) \ar[r, "\texttt{completion\_towerHom}", "\iota"'] \ar[dr, "\phi"', bend right=20]
  & \texttt{completionPowTower}(I) \ar[d, "\exists!\, \bar{\phi}", dashed] \\
  & \texttt{idealPowTower}(J) \quad (S \text{ ãŒå®Œå‚™})
\end{tikzcd}
\caption{å®Œå‚™åŒ–ã®æ™®éæ€§ï¼šä»»æ„ã®å¡”æº–åŒå‹ $\phi$ ã¯ $\iota$ ã‚’çµŒç”±ã—ã¦ä¸€æ„åˆ†è§£ã™ã‚‹}
\label{fig:univ-prop}
\end{figure}

\begin{proposition}[åˆæˆã®äº’æ›æ€§]\label{prop:comp-compat}
$\phi\colon S \to R$ ãŒç’°æº–åŒå‹ï¼Œ$J \subseteq S$ ãŒã‚¤ãƒ‡ã‚¢ãƒ«ã§ $\phi(J) \subseteq I$ ã‚’æº€ãŸã™ã¨ãï¼Œ
\[
  \texttt{completion\_towerHom}(I) \circ \texttt{ringHom\_towerHom}(\phi, J, I)
  = \texttt{ringHom\_towerHom}(\iota \circ \phi,\, J,\, \hat{I})
\]
ãŒæˆã‚Šç«‹ã¤ï¼
\end{proposition}

\begin{proof}
ä¸¡è¾ºã® \texttt{toFun} ã‚’æ¯”ã¹ã‚‹ã¨ï¼Œã©ã¡ã‚‰ã‚‚ $\iota \circ \phi$ ã«ç­‰ã—ã„ï¼
\texttt{Hom.ext rfl} ã§çµ‚ã‚ã‚‹ï¼
\end{proof}

\begin{figure}[H]
\centering
\begin{tikzcd}[column sep=4em, row sep=3.5em]
  \texttt{idealPowTower}(J)
    \ar[r, "\texttt{ringHom\_towerHom}(\phi)"]
    \ar[rr, bend left=30, "\texttt{ringHom\_towerHom}(\iota \circ \phi)"]
  & \texttt{idealPowTower}(I)
    \ar[r, "\texttt{completion\_towerHom}"]
  & \texttt{completionPowTower}(I)
\end{tikzcd}
\caption{åˆæˆã®å¯æ›æ€§ï¼šå‘½é¡Œ \ref{prop:comp-compat} ã®å›³å¼çš„è¡¨ç¾}
\end{figure}

\subsection{åˆ†é›¢æ¡ä»¶ä¸‹ã§ã®å˜å°„æ€§}

\begin{theorem}[$\iota$ ã®å˜å°„æ€§]\label{thm:injective}
$I$ ãŒåˆ†é›¢çš„ã§ã‚ã‚‹ãªã‚‰ã°ï¼Œ$\iota\colon R \to \widehat{R}$ ã¯å˜å°„ã§ã‚ã‚‹ï¼š
\[
  \texttt{IsSeparated}(I) \implies \texttt{Function.Injective}(\iota).
\]
\end{theorem}

\begin{proof}
\texttt{isHausdorff\_of\_isSeparated} ã«ã‚ˆã‚Š $R$ ã¯ $I$-adic Hausdorff ã¨ãªã‚‹ï¼
Mathlib ã® \texttt{AdicCompletion.of\_inj} ã‚’ä½¿ã†ã¨ï¼Œ
\texttt{AdicCompletion.of} $I\, R$ ãŒå˜å°„ã§ã‚ã‚‹ã“ã¨ãŒåˆ†ã‹ã‚‹ï¼
\texttt{completionMap} ã¨ \texttt{AdicCompletion.of} ã¯åŒã˜åŸ‹ã‚è¾¼ã¿ã§ã‚ã‚‹ã‹ã‚‰ï¼Œçµè«–ã‚’å¾—ã‚‹ï¼
\end{proof}

\begin{mathinsight}
åˆ†é›¢æ¡ä»¶ $\bigcap_n I^n = 0$ ã¯ã€Œ$I$-adic ãƒ•ã‚£ãƒ«ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãŒ $R$ ã®å…ƒã‚’ååˆ†åŒºåˆ¥ã§ãã‚‹ã€ã“ã¨ã‚’æ„å‘³ã—ï¼Œ
ãã‚ŒãŒ $\iota$ ã®å˜å°„æ€§ã‚’ä¿è¨¼ã™ã‚‹ï¼
å›³å¼çš„ã«ï¼š
\begin{center}
\begin{tikzcd}
  R \ar[rr, "\iota", hook] \ar[dr, "\text{å•†}"']
  & & \widehat{R} \\
  & R/(I^n) \ar[ur, "\varprojlim"']
\end{tikzcd}
\end{center}
\end{mathinsight}

\begin{leancode}[caption={L6-3b: å®Œå‚™åŒ–å¡”æº–åŒå‹ã¨å˜å°„æ€§}]
-- L6-3b: iota ãŒ tower hom ã‚’èª˜å°ã™ã‚‹ï¼ˆringHom_towerHom ã®ç›´æ¥é©ç”¨ï¼‰
noncomputable def completion_towerHom :
    Hom (idealPowTower I) (completionPowTower I) :=
  ringHom_towerHom (completionMap I) I (completionIdeal I) le_rfl

-- L6-3e: åˆ†é›¢æ¡ä»¶ä¸‹ã§ã® iota ã®å˜å°„æ€§
theorem completion_towerHom_injective_of_separated
    (hI : IsSeparated I) :
    Function.Injective (completionMap I) := by
  let _ : IsHausdorff I R := isHausdorff_of_isSeparated I hI
  intro x y hxy
  have hxy' : AdicCompletion.of I R x = AdicCompletion.of I R y := by
    simpa only [completionMap, completionRing] using hxy
  exact (AdicCompletion.of_inj (I := I) (M := R)).mp hxy'
\end{leancode}

% =============================================================================
\section{\S L6-4ï¼šå®Œå‚™å¡”ã¨ ClosedTower}
% =============================================================================

\subsection{å®Œå‚™åŒ–å¡”ã® ClosedTower æ§‹é€ }

Level 5 ã§ã¯ \texttt{idealPowTower}$(I)$ ãŒ \texttt{idealClosure}ï¼ˆ$= $ ã‚¤ãƒ‡ã‚¢ãƒ«ã® Span ä½œç”¨ç´ ï¼‰ã«é–¢ã™ã‚‹ ClosedTower ã§ã‚ã‚‹ã“ã¨ã‚’ç¤ºã—ãŸï¼
Level 6 ã§ã¯ï¼Œã“ã®çµæœã‚’ $\widehat{R}$ ã«ã€Œã‚³ãƒ”ãƒ¼ã€ã™ã‚‹ï¼š

\begin{theorem}[å®Œå‚™åŒ–å¡”ã¯ ClosedTower]
\[
  \texttt{completionPowTower}(I) = \texttt{idealPowTower}(\hat{I})
\]
ã¯ï¼Œ$\widehat{R}$ ä¸Šã® \texttt{idealClosure} ã«é–¢ã™ã‚‹ ClosedTower ã§ã‚ã‚‹ï¼
\end{theorem}

\begin{proof}
Level 5 ã® \texttt{idealPowTower\_closedTower} ã‚’ $\hat{I}$ ã«é©ç”¨ã™ã‚‹ã ã‘ã§ã‚ã‚‹ï¼š
å„ $n$ ã«å¯¾ã—ã¦ $\hat{I}^n$ ã¯ã‚¤ãƒ‡ã‚¢ãƒ«ãªã®ã§ï¼Œãã® \texttt{Ideal.span} ã¯è‡ªåˆ†è‡ªèº«ã«ç­‰ã—ã„ï¼
\end{proof}

\subsection{å®Œå‚™åŒ–ã®åˆ†é›¢æ€§}

\begin{theorem}[å®Œå‚™åŒ–ã¯è‡ªå‹•çš„ã«åˆ†é›¢çš„]\label{thm:completion-sep}
\[
  \texttt{IsSeparated}(\hat{I}),
  \quad\text{ã™ãªã‚ã¡}\quad
  \bigcap_{n \in \mathbb{N}} \hat{I}^n = 0 \;\text{ in }\; \widehat{R}.
\]
\end{theorem}

\begin{proof}
Mathlib ã¯ $\widehat{R}$ ã«å¯¾ã—ã¦ $\hat{I}$-adic Hausdorff æ€§ã‚’ä»˜ä¸ã—ã¦ã„ã‚‹
ï¼ˆ\texttt{IsHausdorff.map\_algebraMap\_iff} ã¨ \texttt{inferInstance}ï¼‰ï¼
ã“ã‚Œã‚ˆã‚Š \texttt{isSeparated\_of\_isHausdorff} ã‚’é©ç”¨ã—ã¦åˆ†é›¢æ€§ã‚’å¾—ã‚‹ï¼
\end{proof}

\begin{corollary}[å®Œå‚™åŒ–ã® global ã¯ $\{0\}$]
\[
  \texttt{global}(\texttt{completionPowTower}(I)) = \{0\} \subseteq \widehat{R}.
\]
\end{corollary}

\begin{proof}
å®šç† \ref{thm:completion-sep} ã¨ Level 5 ã® \texttt{isSeparated\_iff\_global\_eq} ã‚ˆã‚Šç›´ã¡ã«å¾“ã†ï¼
\end{proof}

\subsection{å®Œå‚™åŒ–ç‰ˆãƒ»è„±å‡ºå®šç†}

\begin{theorem}[è„±å‡ºå®šç†ï¼ˆå®Œå‚™åŒ–ç‰ˆï¼‰]\label{thm:escape}
$x \in \widehat{R}$ ãŒ $x \neq 0$ ãªã‚‰ã°ï¼Œ
\[
  \exists n \in \mathbb{N},\quad x \notin \hat{I}^n.
\]
ã™ãªã‚ã¡ï¼Œé›¶ã§ãªã„å…ƒã¯æœ‰é™æ®µã§ $\hat{I}$-adic tower ã‹ã‚‰è„±å‡ºã™ã‚‹ï¼
\end{theorem}

\begin{proof}
å®šç† \ref{thm:completion-sep} ã¨ Level 5 ã® \texttt{escape\_of\_isSeparated} ã®ç›´æ¥é©ç”¨ï¼š
\texttt{escape\_of\_isSeparated} $(\hat{I})$ (\texttt{completionPowTower\_isSeparated} $I$) $hx$ï¼
\end{proof}

\subsection{global ã®é–‰æ€§}

\begin{theorem}[global ã®é–‰æ€§]\label{thm:global-closed}
\[
  \texttt{idealClosure}(\texttt{global}(\texttt{completionPowTower}(I)))
  \subseteq \texttt{global}(\texttt{completionPowTower}(I)).
\]
\end{theorem}

\begin{proof}
\texttt{completionPowTower} ãŒ ClosedTower ã§ã‚ã‚‹ã“ã¨ã‹ã‚‰ï¼Œ
Level 3 ã® \texttt{ClosedTower.cl\_global\_subset} ã‚’ç›´æ¥é©ç”¨ã™ã‚‹ï¼
\end{proof}

\begin{remark}
å®šç† \ref{thm:global-closed} ã¨ç³»ï¼ˆglobal $= \{0\}$ï¼‰ã‚’åˆã‚ã›ã‚‹ã¨ï¼Œ
\texttt{idealClosure} $\{0\} \subseteq \{0\}$ï¼Œ
ã™ãªã‚ã¡ $\{0\}$ ãŒ \texttt{idealClosure} ã®ä¸å‹•ç‚¹ã§ã‚ã‚‹ã“ã¨ãŒç¢ºèªã§ãã‚‹ï¼ˆè‡ªæ˜ã ãŒæ çµ„ã¿ã®æ•´åˆæ€§ã®æ¤œè¨¼ï¼‰ï¼
\end{remark}

\begin{figure}[H]
\centering
\begin{tikzcd}[column sep=5em, row sep=3.5em]
  R \ar[r, "\iota", hook] \ar[d, "\texttt{idealPowTower}(I)"']
  & \widehat{R} \ar[d, "\texttt{completionPowTower}(I)"] \\
  \texttt{StructureTower}\; \mathbb{N}^{\mathrm{op}}\; R
    \ar[r, "\texttt{completion\_towerHom}"]
    \ar[d, "\text{ClosedTower (L5)}"']
  & \texttt{StructureTower}\; \mathbb{N}^{\mathrm{op}}\; \widehat{R}
    \ar[d, "\text{ClosedTower (L6)}"] \\
  \texttt{global} = \{0\} \text{ iff Separated}
    \ar[r, "\text{è‡ªå‹•çš„ã«æˆç«‹}"]
  & \texttt{global} = \{0\} \text{ ï¼ˆå¸¸ã«ï¼‰}
\end{tikzcd}
\caption{L5 ã¨ L6 ã®å¯¾å¿œï¼š$R$ ã®æ§‹é€ ãŒ $\widehat{R}$ ã«ã€Œè‡ªå‹•æ”¹å–„ã€ã•ã‚Œã‚‹}
\label{fig:l5-l6-compare}
\end{figure}

\begin{leancode}[caption={L6-4: å®Œå‚™å¡”ã® ClosedTower ã¨åˆ†é›¢æ€§}]
-- L6-4a: å®Œå‚™åŒ–å¡”ã¯ ClosedTower
noncomputable def completionPowTower_closedTower :
    ClosedTower (idealClosure (R := completionRing I)) Nod :=
  idealPowTower_closedTower (completionIdeal I)

-- L6-4b: å®Œå‚™åŒ–ã¯è‡ªå‹•çš„ã«åˆ†é›¢çš„
theorem completionPowTower_isSeparated :
    IsSeparated (completionIdeal I) := by
  let _ : IsHausdorff (completionIdeal I) (completionRing I) :=
    (IsHausdorff.map_algebraMap_iff (I := I) (S := completionRing I)).2
      (inferInstance : IsHausdorff I (completionRing I))
  exact isSeparated_of_isHausdorff (completionIdeal I)

-- L6-4e: global ã®é–‰æ€§
theorem completionPow_global_closed :
    idealClosure (R := completionRing I) (completionPowTower I).global
      subseteq (completionPowTower I).global :=
  (completionPowTower_closedTower I).cl_global_subset
\end{leancode}

% =============================================================================
\section{Level 6 ã®å…¨ä½“åƒï¼šL1--L6 ã®åˆæµ}
% =============================================================================

\subsection{å„ãƒ¬ãƒ™ãƒ«ã®å¯¾å¿œè¡¨}

\begin{center}
\begin{tabular}{lll}
\toprule
\textbf{æ¦‚å¿µ} & \textbf{L5 ã§ã®ç¢ºèª} & \textbf{L6 ã§ã®ç™ºå±•} \\
\midrule
\texttt{StructureTower} & \texttt{idealPowTower}$(R)$ & Cauchy å¡”$(\mathbb{N} \to R)$, å®Œå‚™åŒ–å¡”$(\widehat{R})$ \\
ä¹—æ³•äº’æ›æ€§ & \texttt{mul\_mem} & åŠ æ³•ãƒ»ã‚¹ã‚«ãƒ©ãƒ¼é–‰æ€§ \\
\texttt{ClosedTower} & L5-2c & å®Œå‚™åŒ–ç‰ˆï¼ˆL6-4aï¼‰ \\
\texttt{cl\_global\_subset} & L5-2d & å®Œå‚™åŒ–ç‰ˆï¼ˆL6-4eï¼‰ \\
ç’°æº–åŒå‹ $\to$ Hom & \texttt{ringHom\_towerHom} & $\iota$ ã«ã‚ˆã‚‹å¡”æº–åŒå‹ï¼ˆL6-3bï¼‰ \\
åˆ†é›¢æ¡ä»¶ & \texttt{IsSeparated} æ¤œè¨¼ & $\widehat{R}$ ã§ã¯è‡ªå‹•æˆç«‹ï¼ˆL6-4bï¼‰ \\
è„±å‡ºå®šç† & \texttt{escape\_of\_isSeparated} & å®Œå‚™åŒ–ç‰ˆï¼ˆL6-4dï¼‰ \\
\texttt{global} $= \{0\}$ & ä»®å®šã¨ã—ã¦è¦æ±‚ & å®Œå‚™åŒ–ã§å¸¸ã«æˆç«‹ï¼ˆL6-4cï¼‰ \\
\bottomrule
\end{tabular}
\end{center}

\subsection{å®Œå‚™åŒ–ã®ã€Œæœ€è‰¯æ€§ã€}

\begin{mathinsight}
Bourbaki ã®å®Œå‚™åŒ–ã®æ™®éæ€§ï¼š$\widehat{R}$ ã¯
\begin{enumerate}
  \item \textbf{StructureTower}ï¼š$\hat{I}$-adic ãƒ•ã‚£ãƒ«ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æŒã¤ï¼›
  \item \textbf{ClosedTower}ï¼šå„ $\hat{I}^n$ ãŒ \texttt{idealClosure} ã®ä¸å‹•ç‚¹ï¼›
  \item \textbf{åˆ†é›¢çš„}ï¼š$\bigcap_n \hat{I}^n = 0$ï¼ˆè‡ªå‹•çš„ã«æˆç«‹ï¼‰ï¼›
  \item \textbf{å®Œå‚™çš„}ï¼šCauchy åˆ—ãŒåæŸã™ã‚‹ï¼›
\end{enumerate}
ã‚’åŒæ™‚ã«æº€ãŸã™ $R$ ã®ã€Œæœ€å°æ‹¡å¤§ã€ã§ã‚ã‚‹ï¼
Level 1--5 ã§è“„ç©ã—ãŸå…¨æ¡ä»¶ãŒï¼Œå®Œå‚™åŒ–ã«ãŠã„ã¦åˆã‚ã¦ä¸€æ–‰ã«å®Ÿç¾ã•ã‚Œã‚‹ï¼
\end{mathinsight}

\begin{figure}[H]
\centering
\begin{tikzpicture}[
  node/.style={draw, rounded corners=5pt, minimum width=4.5cm, minimum height=1cm, align=center, font=\small},
  arrow/.style={-Stealth, thick, leanblue},
  label/.style={font=\footnotesize, midway, above},
]
  \node[node, fill=leanbg] (L1) at (0, 8) {L1: \texttt{StructureTower}\\åŸºæœ¬å®šç¾©ãƒ»åœæ§‹é€ };
  \node[node, fill=leanbg] (L2) at (0, 6.3) {L2: \texttt{Hom}ãƒ»åˆæˆãƒ»è‡ªç„¶æ€§};
  \node[node, fill=leanbg] (L3) at (0, 4.6) {L3: \texttt{ClosedTower}\\é–‰åŒ…ä½œç”¨ç´ };
  \node[node, fill=leanbg] (L4) at (0, 2.9) {L4: \texttt{NatInclusion}\\è‡ªç„¶ãªåŒ…å«é–¢ä¿‚};
  \node[node, fill=warningcolor] (L5) at (0, 1.2) {L5: \texttt{idealPowTower}\\$I$-adic canonical ä¾‹};
  \node[node, fill=cauchycolor, minimum width=5.5cm] (L6) at (0, -0.8)
    {L6: $I$-adic å®Œå‚™åŒ–\\Cauchy åˆ—ãƒ»æ™®éæ€§ãƒ»ClosedTower};
  \draw[arrow] (L1) -- (L2);
  \draw[arrow] (L2) -- (L3);
  \draw[arrow] (L3) -- (L4);
  \draw[arrow] (L4) -- (L5);
  \draw[arrow] (L5) -- (L6) node[label] {};
  \node[font=\footnotesize, right] at (0.75, 0.2) {å…¨æ§‹é€ ãŒåˆæµ};
\end{tikzpicture}
\caption{Level 1--6 ã®ç©ã¿ä¸Šã’æ§‹é€ }
\end{figure}

\subsection{æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—å€™è£œï¼ˆLevel 7 ä»¥é™ï¼‰}

\begin{enumerate}
  \item \textbf{Cauchy åˆ—ã®åæŸã¨å®Œå‚™æ€§}ï¼š
    \texttt{cauchySeqTower} ã®å…ƒãŒ $\widehat{R}$ ä¸Šã§åæŸã™ã‚‹ã“ã¨ã‚’ç¤ºã™ï¼
    é€†æ¥µé™ $\varprojlim R/I^n$ ã¨ã®åŒå‹ã‚’æ§‹æˆã—ï¼Œ
    \texttt{StructureTower} ã¨ã—ã¦ã®åŒå€¤æ€§ã‚’ç¢ºèªã™ã‚‹ï¼

  \item \textbf{Rees ä»£æ•°ã¨æ¬¡æ•°ä»˜ãæ§‹é€ }ï¼š
    $\bigoplus_n I^n t^n$ ã‚’ \texttt{StructureTower} ã®ç›´å’Œã¨ã—ã¦è¨˜è¿°ã™ã‚‹ï¼
    æ¬¡æ•°ç’° (graded ring) ã¨ \texttt{StructureTower} ã®ã€Œæ¬¡æ•°ä»˜ãå°„ã€ã®é–¢ä¿‚ã‚’å½¢å¼åŒ–ã™ã‚‹ï¼

  \item \textbf{Mathlib \texttt{CategoryTheory.Monad} ã¨ã®æ­£å¼æ¥ç¶š}ï¼š
    \texttt{idealClosure} ã® \texttt{ClosedTower} ãŒ
    \texttt{CategoryTheory.Monad.Algebra} ã¨åŒå‹ã§ã‚ã‚‹ã“ã¨ã‚’å½¢å¼è¨¼æ˜ã™ã‚‹ï¼
    Level 3 ã®ãƒ¢ãƒŠãƒ‰æ³•å‰‡ã®åœè«–ç‰ˆã¸ã®æ©‹æ¸¡ã—ï¼
\end{enumerate}

% =============================================================================
\section*{ã¾ã¨ã‚}
% =============================================================================
\addcontentsline{toc}{section}{ã¾ã¨ã‚}

æœ¬ç¨¿ã§ã¯ï¼ŒStructure Tower æ¼”ç¿’ Level 6 ã¨ã—ã¦ $I$-adic å®Œå‚™åŒ–ã‚’ \texttt{StructureTower} ã®è¨€èªã§è¨˜è¿°ã—ãŸ Lean 4 ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ•°å­¦çš„ã«è§£èª¬ã—ãŸï¼

\begin{itemize}
  \item \S L6-1 ã§ã¯ Cauchy åˆ—ã®ã€Œé€Ÿã•ã€ã‚’éšå±¤åŒ–ã—ãŸ \texttt{cauchySeqTower} ã‚’æ§‹æˆã—ï¼ŒåŠ æ³•ãƒ»ã‚¹ã‚«ãƒ©ãƒ¼å€ã®é–‰æ€§ã‚’ç¢ºèªã—ãŸï¼
  \item \S L6-2 ã§ã¯ null åˆ—ã®ä»£æ•°çš„é–‰æ€§ã‹ã‚‰ $I$-adic Setoid ã‚’æ§‹æˆã—ï¼Œåˆ†é›¢æ¡ä»¶ä¸‹ã§å®šæ•° null åˆ—ãŒé›¶åˆ—ã®ã¿ã§ã‚ã‚‹ã“ã¨ã‚’ç¤ºã—ãŸï¼
  \item \S L6-3 ã§ã¯ Mathlib ã® \texttt{AdicCompletion} ã‚’åˆ©ç”¨ã—ã¦å®Œå‚™åŒ–å¡”ã‚’æ§‹æˆã—ï¼ŒåŸ‹ã‚è¾¼ã¿ $\iota$ ãŒå¡”æº–åŒå‹ã‚’èª˜å°ã™ã‚‹ã“ã¨ã‚’ç¢ºèªã—ãŸï¼ˆLevel 5 ã® \texttt{ringHom\_towerHom} ã® canonical é©ç”¨ï¼‰ï¼
  \item \S L6-4 ã§ã¯å®Œå‚™åŒ–å¡”ãŒ \texttt{ClosedTower} ã§ã‚ã‚Šï¼Œè‡ªå‹•çš„ã«åˆ†é›¢çš„ã‹ã¤ global $= \{0\}$ ã‚’æº€ãŸã™ã“ã¨ã‚’ç¤ºã—ãŸï¼
\end{itemize}

Bourbaki ã®æ¯æ§‹é€ è«–çš„ãªè¦–ç‚¹â€”â€”é †åºãƒ»ä»£æ•°ãƒ»ä½ç›¸ã®ä¸‰ä½ä¸€ä½“â€”â€”ãŒï¼Œ\texttt{StructureTower} ã¨ã„ã†å˜ä¸€ã®æ çµ„ã¿ã«çµ±åˆã•ã‚Œã‚‹éç¨‹ã‚’ï¼ŒLean 4 ã®å½¢å¼çš„è¨¼æ˜ã¨ã—ã¦æ˜ç¤ºã§ããŸï¼

% =============================================================================
\end{document}

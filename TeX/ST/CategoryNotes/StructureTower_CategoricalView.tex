% =============================================================================
% StructureTower â€” åœè«–çš„è¦–ç‚¹
% LuaLaTeX æ–‡æ›¸
% =============================================================================
\documentclass[a4paper,11pt]{ltjsarticle}

% --- Core packages ---
\usepackage{luatexja-fontspec}
\usepackage{amsmath,amssymb,amsthm}
\usepackage{mathtools}
\usepackage{tikz-cd}
\usepackage{tikz}
\usetikzlibrary{arrows,decorations.markings,positioning,calc}
\usepackage{enumitem}
\usepackage{hyperref}
\usepackage{cleveref}
\usepackage{tcolorbox}
\usepackage{listings}
\usepackage{xcolor}
\usepackage{geometry}
\usepackage{fancyhdr}
\usepackage{float}
\usepackage{booktabs}
\usepackage{array}

% --- Page geometry ---
\geometry{margin=2.5cm, top=3cm, bottom=3cm}

% --- Fonts ---
\setmainjfont{Harano Aji Mincho}[BoldFont=HaranoAjiMincho-Bold]
\setsansjfont{Harano Aji Gothic}[BoldFont=HaranoAjiGothic-Bold]

% --- Colors ---
\definecolor{leanblue}{HTML}{2563EB}
\definecolor{leanbg}{HTML}{F8FAFC}
\definecolor{leancomment}{HTML}{6B7280}
\definecolor{leankeyword}{HTML}{7C3AED}
\definecolor{leanstring}{HTML}{059669}
\definecolor{accentcolor}{HTML}{1E40AF}
\definecolor{theoremcolor}{HTML}{EFF6FF}
\definecolor{definitioncolor}{HTML}{F0FDF4}
\definecolor{remarkcolor}{HTML}{FFF7ED}
\definecolor{exercisecolor}{HTML}{FDF4FF}

% --- Hyperref ---
\hypersetup{
  colorlinks=true,
  linkcolor=accentcolor,
  urlcolor=leanblue,
  citecolor=accentcolor,
  pdftitle={StructureTower åœè«–çš„è¦–ç‚¹},
  pdfauthor={su},
}

% --- Theorem environments ---
\theoremstyle{definition}
\newtheorem{definition}{å®šç¾©}[section]
\newtheorem{example}[definition]{ä¾‹}
\newtheorem{exercise}[definition]{æ¼”ç¿’}

\theoremstyle{plain}
\newtheorem{theorem}[definition]{å®šç†}
\newtheorem{lemma}[definition]{è£œé¡Œ}
\newtheorem{proposition}[definition]{å‘½é¡Œ}
\newtheorem{corollary}[definition]{ç³»}

\theoremstyle{remark}
\newtheorem{remark}[definition]{æ³¨æ„}

% --- Lean code environment ---
\lstdefinelanguage{lean4}{
  morekeywords={def,theorem,lemma,example,instance,class,structure,
    where,let,in,do,if,then,else,match,with,fun,return,
    import,open,namespace,section,end,variable,
    inductive,abbrev,noncomputable,private,protected,
    sorry,admit,have,show,suffices,calc,by,exact,
    apply,intro,intros,constructor,cases,induction,
    simp,rw,rfl,ext,ring,linarith,omega,norm_num,
    decide,trivial,assumption,contradiction,
    Type,Prop,Sort,Set,true,false,
    rcases,refine,trans,
    attribute,deriving},
  sensitive=true,
  morecomment=[l]{--},
  morecomment=[n]{/-}{-/},
  morestring=[b]",
  literate=
    {->}{{\(\to\)}}2
    {<->}{{\(\leftrightarrow\)}}3
    {<=}{{\(\leq\)}}2
    {>=}{{\(\geq\)}}2,
}

\lstnewenvironment{leancode}[1][]{%
  \lstset{
    language=lean4,
    basicstyle=\ttfamily\footnotesize,
    keywordstyle=\color{leankeyword}\bfseries,
    commentstyle=\color{leancomment}\itshape,
    stringstyle=\color{leanstring},
    backgroundcolor=\color{leanbg},
    frame=single,
    rulecolor=\color{leanblue!30},
    framesep=8pt,
    xleftmargin=12pt,
    xrightmargin=12pt,
    breaklines=true,
    breakatwhitespace=true,
    showstringspaces=false,
    tabsize=2,
    captionpos=b,
    numbers=left,
    numberstyle=\tiny\color{leancomment},
    numbersep=8pt,
    aboveskip=1em,
    belowskip=1em,
    inputencoding=utf8,
    extendedchars=true,
    #1
  }%
}{}

% --- Tcolorbox styles ---
\tcbuselibrary{skins,breakable}

\newtcolorbox{proofstrategy}{
  colback=remarkcolor,
  colframe=orange!60!black,
  title={\textbf{è¨¼æ˜æˆ¦ç•¥}},
  fonttitle=\sffamily,
  boxrule=0.5pt,
  arc=3pt,
}

\newtcolorbox{mathinsight}{
  colback=theoremcolor,
  colframe=accentcolor,
  title={\textbf{æ•°å­¦çš„æ´å¯Ÿ}},
  fonttitle=\sffamily,
  boxrule=0.5pt,
  arc=3pt,
}

\newtcolorbox{exercisebox}{
  colback=exercisecolor,
  colframe=purple!60!black,
  title={\textbf{æ¼”ç¿’å•é¡Œ}},
  fonttitle=\sffamily,
  boxrule=0.5pt,
  arc=3pt,
}

% --- Header/Footer ---
\pagestyle{fancy}
\fancyhf{}
\renewcommand{\headrulewidth}{0.4pt}
\fancyhead[L]{\small\sffamily\nouppercase{\leftmark}}
\fancyhead[R]{\small\sffamily StructureTower åœè«–çš„è¦–ç‚¹}
\fancyfoot[C]{\thepage}

% --- Macros ---
\newcommand{\colonequiv}{\coloneqq}
\newcommand{\Tower}{\mathsf{Tower}}
\newcommand{\Set}{\mathbf{Set}}
\newcommand{\Nat}{\mathrm{Nat}}
\newcommand{\Hom}{\mathrm{Hom}}
\newcommand{\Id}{\mathrm{id}}
\newcommand{\map}{\mathrm{map}}
\newcommand{\comap}{\mathrm{comap}}
\newcommand{\reindex}{\mathrm{reindex}}
\newcommand{\colim}{\mathrm{colim}}
\newcommand{\NatIncl}{\hookrightarrow_{\mathrm{lw}}}
\newcommand{\Fix}{\mathrm{Fix}}
\newcommand{\EMAlg}{\mathrm{EMAlg}}
\newcommand{\Kl}{\mathrm{Kl}}
\newcommand{\EM}{\mathrm{EM}}
\newcommand{\OrderHom}{\mathsf{OrderHom}}

% =============================================================================
\begin{document}

% --- Title ---
\title{%
  {\LARGE\sffamily\bfseries StructureTower ã®åœè«–çš„è¦–ç‚¹}\\[0.5em]
  {\large\sffamily Lean 4 / Mathlib4 ã«ã‚ˆã‚‹å½¢å¼åŒ–ã¨ãã®æ•°å­¦çš„è§£èª¬}%
}
\author{su}
\date{2026å¹´2æœˆ}
\maketitle

% --- AI Disclosure ---
\begin{center}
\small
\textit{AI assistance disclosure:}\\
Lean ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã¯ Claude (Anthropic) ã§éª¨æ ¼ã‚’ç”Ÿæˆã—ã€
Codex (OpenAI) ã§ä¿®æ­£ã—ãŸã€‚\\
\TeX\ æ–‡æ›¸ã¯ Claude Code (Anthropic) ã§ç”Ÿæˆã—ãŸã€‚\\
è‘—è€…ã«ã‚ˆã‚‹åŠ ç­†ãƒ»ä¿®æ­£ã¯è¡Œã£ã¦ã„ãªã„ã€‚\\
å†…å®¹ã®æ­£ç¢ºæ€§ã¯ä¿è¨¼ã•ã‚Œãšã€èª¤ã‚ŠãŒã‚ã‚Œã°è‘—è€…ã®è²¬ä»»ã§ã‚ã‚‹ã€‚
\end{center}

\vspace{1em}

% --- Abstract ---
\begin{abstract}
æœ¬ç¨¿ã§ã¯ï¼Œå‰é †åºé›†åˆ $\iota$ ã§æ·»å­—ã¥ã‘ã‚‰ã‚ŒãŸé›†åˆã®å˜èª¿æ—
$\mathrm{StructureTower}(\iota, \alpha)$
ã‚’åœè«–çš„ã«çµ„ç¹”åŒ–ã™ã‚‹ Lean 4 å½¢å¼åŒ–ã‚’è§£èª¬ã™ã‚‹ï¼
ã¾ãšå¡”ã®åœ $\Tower(\iota)$ ã‚’å®šç¾©ã—ï¼Œãã®åœã®å…¬ç†ï¼ˆå˜ä½å¾‹ãƒ»çµåˆå¾‹ï¼‰ã‚’æ¤œè¨¼ã™ã‚‹ï¼
æ¬¡ã«ï¼ŒåŒä¸€å°ä¸Šã®å¡”ã®é–“ã® levelwise åŒ…å«ãŒè‡ªç„¶å¤‰æ›ã«å¯¾å¿œã™ã‚‹ã“ã¨ã‚’ç¤ºã™ï¼
ã•ã‚‰ã«ï¼Œå†™åƒ $f\colon\alpha\to\beta$ ã«æ²¿ã†å…±å¤‰é–¢æ‰‹ $\map(f)$ ã¨åå¤‰é–¢æ‰‹
$\comap(f)$ï¼ŒãŠã‚ˆã³å‰é †åºã®å°„ $\varphi\colon\iota\to\kappa$ ã«æ²¿ã†å†æ·»å­—é–¢æ‰‹
$\reindex(\varphi)$ ã‚’æ§‹æˆã—ï¼Œãã‚Œã‚‰ã®é–¢æ‰‹æ³•å‰‡ã‚’è¨¼æ˜ã™ã‚‹ï¼
æ¥µé™ãƒ»ä½™æ¥µé™ã®è¦³ç‚¹ã‹ã‚‰ã¯ï¼Œå¡”ã® levelwise äº¤å‰ãƒ»åˆä½µãŒç©ãƒ»ä½™ç©ãƒ»ç­‰åŒ–å­ã‚’ä¸ãˆã‚‹ã“ã¨ã‚’ç¤ºã™ï¼
ã¾ãŸï¼Œé–‰åŒ…ä½œç”¨ç´ ã‹ã‚‰å®šã¾ã‚‹å¡”ãŒé–‰åŒ…ãƒ¢ãƒŠãƒ‰ã®æ§‹é€ ã‚’æŒã¤ã“ã¨ï¼Œ
ãã“ã‹ã‚‰ Kleisli åœã¨ Eilenberg--Moore ä»£æ•°ãŒå¾—ã‚‰ã‚Œã‚‹ã“ã¨ã‚’è«–ã˜ã‚‹ï¼
æœ€å¾Œã«ï¼Œ$\mathrm{StructureTower}(\iota,\alpha)$ ãŒé †åºæº–åŒå‹ã®åœ
$\OrderHom(\iota, \mathcal{P}(\alpha))$ ã¨åŒå€¤ã§ã‚ã‚‹ã“ã¨ã‚’ç¤ºã™ï¼
\end{abstract}

\tableofcontents
\newpage

% =============================================================================
\section{åºè«–ï¼šå¡”ã¨ã„ã†æ§‹é€ }
% =============================================================================

æ•°å­¦ã«ãŠã„ã¦ï¼Œé›†åˆã®ã€Œæ®µéšçš„ãªæ‹¡å¤§åˆ—ã€ã¯ã„ãŸã‚‹ã¨ã“ã‚ã«ç¾ã‚Œã‚‹ï¼
ãƒ•ã‚£ãƒ«ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼Œé–‰åŒ…ç³»ï¼Œå±¤ã®èŒï¼Œã‚¤ãƒ‡ã‚¢ãƒ«ã®å¢—å¤§åˆ—â€¦â€¦
ã“ã‚Œã‚‰ã¯ã™ã¹ã¦ï¼Œã‚ã‚‹åŠé †åºé›†åˆã§æ·»å­—ã¥ã‘ã‚‰ã‚ŒãŸé›†åˆã®å˜èª¿æ—ã¨ã—ã¦çµ±ä¸€çš„ã«æ‰ãˆã‚‰ã‚Œã‚‹ï¼

æœ¬ç¨¿ãŒæ‰±ã† \emph{æ§‹é€ å¡”} $\mathrm{StructureTower}(\iota,\alpha)$ ã¯ï¼Œ
å‰é †åºé›†åˆ $(\iota, \leq)$ ã§æ·»å­—ã¥ã‘ã‚‰ã‚ŒãŸ $\alpha$ ã®éƒ¨åˆ†é›†åˆã®æ—
$\{T_i\}_{i\in\iota}$ ã§ã‚ã£ã¦ï¼Œ$i \leq j \Rightarrow T_i \subseteq T_j$
ã‚’æº€ãŸã™ã‚‚ã®ã§ã‚ã‚‹ï¼ã“ã®å®šç¾©ã¯å˜ç´”ã«è¦‹ãˆã‚‹ãŒï¼Œåœè«–çš„ã«è±Šã‹ãªæ§‹é€ ã‚’æŒã¤ï¼

\begin{itemize}
  \item \textbf{Â§1}: å¡”ã‚’å¯¾è±¡ï¼Œãƒ¬ãƒ™ãƒ«ä¿å­˜å†™åƒã‚’å°„ã¨ã™ã‚‹åœ $\Tower(\iota)$ ã®å…¬ç†
  \item \textbf{Â§2}: levelwise åŒ…å« $\NatIncl$ ã‚’è‡ªç„¶å¤‰æ›ã¨ã—ã¦è§£é‡ˆ
  \item \textbf{Â§3}: $\map$, $\comap$, $\reindex$ ã¨ã„ã†3ç¨®ã®é–¢æ‰‹çš„æ“ä½œ
  \item \textbf{Â§4}: ç©ãƒ»ä½™ç©ãƒ»ç­‰åŒ–å­ã® levelwise æ§‹æˆã¨æ™®éæ€§
  \item \textbf{Â§5}: é–‰åŒ…ä½œç”¨ç´ ã‹ã‚‰å®šã¾ã‚‹ãƒ¢ãƒŠãƒ‰ã¨ Kleisli / EM ã®ç†è«–
  \item \textbf{Â§6}: $\OrderHom(\iota, \mathcal{P}(\alpha))$ ã¨ã®åŒå€¤æ€§
\end{itemize}

% =============================================================================
\section{åŸºç¤ï¼šæ§‹é€ å¡”ã¨å¡”ã®åœ}
\label{sec:foundation}
% =============================================================================

\subsection{æ§‹é€ å¡”ã®å®šç¾©}

\begin{definition}[æ§‹é€ å¡”]
\label{def:structure-tower}
å‰é †åºé›†åˆ $(\iota,\leq)$ ã¨é›†åˆ $\alpha$ ã‚’å›ºå®šã™ã‚‹ï¼
\emph{æ§‹é€ å¡”} $T = (T_i)_{i\in\iota}$ ã¨ã¯ï¼Œ
å„ $i\in\iota$ ã« $\alpha$ ã®éƒ¨åˆ†é›†åˆ $T_i \subseteq \alpha$ ã‚’å¯¾å¿œã•ã›ã‚‹æ—ã§ã‚ã£ã¦ï¼Œ
\[
  i \leq j \;\Longrightarrow\; T_i \subseteq T_j
  \qquad (\forall\, i,j\in\iota)
\]
ã‚’æº€ãŸã™ã‚‚ã®ã§ã‚ã‚‹ï¼$\mathrm{StructureTower}(\iota, \alpha)$ ã§ãã®å…¨ä½“ã‚’è¡¨ã™ï¼
\end{definition}

Lean 4 ã§ã¯æ¬¡ã®ã‚ˆã†ã«å®šç¾©ã•ã‚Œã‚‹ï¼š

\begin{leancode}
@[ext]
structure StructureTower (iota alpha : Type*) [Preorder iota] : Type _ where
  level          : iota -> Set alpha
  monotone_level : forall {i j : iota}, i <= j -> level i <= level j
\end{leancode}

\begin{figure}[H]
\centering
\begin{tikzpicture}[scale=1.2]
  % iota axis
  \draw[->] (0,0) -- (5,0) node[right] {$\iota$};
  \foreach \x/\lab in {0.5/i, 2/j, 3.5/k} {
    \draw (\x,0.05) -- (\x,-0.05) node[below] {$\lab$};
  }
  \draw[->] (0.5,0) -- (1.9,0) node[above,midway,font=\small] {$\leq$};
  \draw[->] (2,0) -- (3.4,0) node[above,midway,font=\small] {$\leq$};
  % Sets
  \draw[fill=blue!10, draw=blue!50, rounded corners] (0.2,0.5) rectangle (0.8,2.0);
  \node[blue!70, font=\small] at (0.5,1.25) {$T_i$};
  \draw[fill=green!10, draw=green!50, rounded corners] (1.7,0.5) rectangle (2.3,3.0);
  \node[green!70, font=\small] at (2.0,1.75) {$T_j$};
  \draw[fill=red!10, draw=red!50, rounded corners] (3.2,0.5) rectangle (3.8,4.0);
  \node[red!70, font=\small] at (3.5,2.25) {$T_k$};
  % Inclusion arrows
  \draw[->, dashed, blue!60] (0.8,1.25) -- (1.7,1.25) node[above,midway,font=\tiny] {$\subseteq$};
  \draw[->, dashed, green!60] (2.3,1.75) -- (3.2,1.75) node[above,midway,font=\tiny] {$\subseteq$};
  % alpha label
  \draw[->] (0,0.3) -- (0,4.3) node[above] {$\mathcal{P}(\alpha)$};
\end{tikzpicture}
\caption{æ§‹é€ å¡”ï¼š$i \leq j \leq k \Rightarrow T_i \subseteq T_j \subseteq T_k$ï¼
  å‰é †åº $\iota$ ã«æ²¿ã£ã¦éƒ¨åˆ†é›†åˆãŒå˜èª¿ã«æ‹¡å¤§ã™ã‚‹ï¼}
\label{fig:structure-tower}
\end{figure}

\subsection{å¡”ã®åœ $\Tower(\iota)$}

\begin{definition}[å¡”ã®åœ]
\label{def:tower-category}
å‰é †åºé›†åˆ $\iota$ ã‚’å›ºå®šã™ã‚‹ï¼\emph{å¡”ã®åœ} $\Tower(\iota)$ ã‚’æ¬¡ã§å®šç¾©ã™ã‚‹ï¼š
\begin{itemize}
  \item \textbf{å¯¾è±¡}ï¼šå‹ $\alpha$ ãŒä»»æ„ã«å¤‰ã‚ã‚‹æ§‹é€ å¡”
    $T \in \mathrm{StructureTower}(\iota, \alpha)$
  \item \textbf{å°„} $f\colon T_1 \to T_2$ï¼ˆ$T_1 \in \mathrm{StructureTower}(\iota,\alpha)$,
    $T_2 \in \mathrm{StructureTower}(\iota,\beta)$ï¼‰ï¼š
    é–¢æ•° $f\colon \alpha \to \beta$ ã§ã‚ã£ã¦ï¼Œå„ãƒ¬ãƒ™ãƒ«ã‚’ä¿å­˜ã™ã‚‹ã‚‚ã®ï¼š
    \[
      f(T_{1,i}) \subseteq T_{2,i} \qquad (\forall\, i \in \iota)
    \]
  \item \textbf{æ’ç­‰å°„}ï¼š$\Id_T = \mathrm{id}_\alpha$
  \item \textbf{åˆæˆ}ï¼š$g \circ f = g_{\mathrm{fun}} \circ f_{\mathrm{fun}}$
\end{itemize}
\end{definition}

\begin{theorem}[åœã®å…¬ç†]
\label{thm:category-axioms}
$\Tower(\iota)$ ã¯ä»¥ä¸‹ã®åœã®å…¬ç†ã‚’ã™ã¹ã¦æº€ãŸã™ï¼š
\begin{enumerate}
  \item \textbf{å·¦å˜ä½å¾‹}ï¼š$\Id \circ f = f$
  \item \textbf{å³å˜ä½å¾‹}ï¼š$f \circ \Id = f$
  \item \textbf{çµåˆå¾‹}ï¼š$(h \circ g) \circ f = h \circ (g \circ f)$
\end{enumerate}
\end{theorem}

\begin{figure}[H]
\centering
\begin{tikzcd}[column sep=4em, row sep=3em]
  T_1 \arrow[r, "f"] \arrow[rr, bend right=20, "g \circ f"']
  & T_2 \arrow[r, "g"]
  & T_3
\end{tikzcd}
\caption{å¡”ã®åœã«ãŠã‘ã‚‹å°„ã®åˆæˆï¼é–¢æ•° $g \circ f\colon \alpha \to \gamma$ ã¯
å„ãƒ¬ãƒ™ãƒ« $i$ ã§ $f(T_{1,i}) \subseteq T_{2,i}$, $g(T_{2,i}) \subseteq T_{3,i}$
ã‚’çµŒç”±ã—ã¦ $g(f(T_{1,i})) \subseteq T_{3,i}$ ã‚’æº€ãŸã™ï¼}
\label{fig:composition}
\end{figure}

\begin{proofstrategy}
å„å…¬ç†ã¯é–¢æ•°åˆæˆã®å…¬ç†ã‹ã‚‰ç›´æ¥å¾“ã†ï¼Lean ã§ã¯ \texttt{ext} ã‚¿ã‚¯ãƒ†ã‚£ã‚¯ã§
é–¢æ•°ã®å¤–å»¶çš„ç­‰å·ã«å¸°ç€ã—ï¼Œ\texttt{rfl} ã§é–‰ã˜ã‚‹ï¼
\end{proofstrategy}

% =============================================================================
\section{è‡ªç„¶å¤‰æ›ã¨ã—ã¦ã® levelwise åŒ…å«}
\label{sec:nat-inclusion}
% =============================================================================

\begin{definition}[NatInclusion / levelwise åŒ…å«]
\label{def:nat-inclusion}
åŒä¸€ã®å‰é †åº $\iota$ ã¨å°é›†åˆ $\alpha$ ã‚’æŒã¤2ã¤ã®å¡”
$T_1, T_2 \in \mathrm{StructureTower}(\iota,\alpha)$ ã«å¯¾ã—ã¦ï¼Œ
\emph{levelwise åŒ…å«} $T_1 \NatIncl T_2$ ã‚’
\[
  T_1 \NatIncl T_2 \;\colonequiv\; \forall i \in \iota,\; T_{1,i} \subseteq T_{2,i}
\]
ã§å®šç¾©ã™ã‚‹ï¼
\end{definition}

\begin{mathinsight}
å„å¡”ã¯é–¢æ‰‹ $T\colon (\iota, \leq) \to (\mathcal{P}(\alpha), \subseteq)$ ã¨ã¿ãªã›ã‚‹ï¼
levelwise åŒ…å« $T_1 \NatIncl T_2$ ã¯ï¼Œã“ã®2ã¤ã®é–¢æ‰‹ã®é–“ã®è‡ªç„¶å¤‰æ›ã«ä»–ãªã‚‰ãªã„ï¼
\[
\begin{tikzcd}[column sep=3em, row sep=2em]
  (\iota,\leq)
    \arrow[rr, bend left=30, "T_1", ""{name=A, below}]
    \arrow[rr, bend right=30, "T_2"', ""{name=B, above}]
  &&
  (\mathcal{P}(\alpha),\subseteq)
  \arrow[from=A, to=B, Rightarrow, "\eta"]
\end{tikzcd}
\]
è‡ªç„¶æ€§æ¡ä»¶ $T_{1,i} \subseteq T_{2,i}$ï¼ˆ$\eta_i$ï¼‰ã¯ Set ã®å°„ãŒ $\subseteq$ ã§ã‚ã‚‹ãŸã‚ï¼Œ
è‡ªç„¶æ€§å›³å¼ã¯è‡ªå‹•çš„ã«å¯æ›ã«ãªã‚‹ï¼
\end{mathinsight}

\begin{proposition}[åŠé †åºæ§‹é€ ]
\label{prop:partial-order}
åŒä¸€å° $\alpha$ ã‚’æŒã¤å¡”å…¨ä½“ $\mathrm{StructureTower}(\iota,\alpha)$ ã®ä¸Šã§ï¼Œ
levelwise åŒ…å«ã¯åŠé †åºã‚’ãªã™ï¼š
\begin{enumerate}
  \item \textbf{åå°„å¾‹}ï¼š$T \NatIncl T$
  \item \textbf{æ¨ç§»å¾‹}ï¼š$T_1 \NatIncl T_2$, $T_2 \NatIncl T_3 \Rightarrow T_1 \NatIncl T_3$
  \item \textbf{åå¯¾ç§°å¾‹}ï¼š$T_1 \NatIncl T_2$, $T_2 \NatIncl T_1 \Rightarrow T_1 = T_2$
\end{enumerate}
\end{proposition}

% =============================================================================
\section{é–¢æ‰‹çš„æ“ä½œï¼šmap, comap, reindex}
\label{sec:functors}
% =============================================================================

3ç¨®ã®é–¢æ‰‹çš„æ“ä½œãŒè‡ªç„¶ã«ç¾ã‚Œã‚‹ï¼

\subsection{å…±å¤‰é–¢æ‰‹ map}

\begin{definition}[map]
\label{def:map}
é–¢æ•° $f\colon \alpha \to \beta$ ã¨å¡” $T \in \mathrm{StructureTower}(\iota,\alpha)$ ã«å¯¾ã—ã¦ï¼Œ
\[
  \map(f)(T)_i \colonequiv f(T_i) = \{f(x) \mid x \in T_i\}
\]
ã«ã‚ˆã‚Šå¡” $\map(f)(T) \in \mathrm{StructureTower}(\iota,\beta)$ ã‚’å®šç¾©ã™ã‚‹ï¼
\end{definition}

\begin{definition}[comap]
\label{def:comap}
é–¢æ•° $f\colon \alpha \to \beta$ ã¨å¡” $S \in \mathrm{StructureTower}(\iota,\beta)$ ã«å¯¾ã—ã¦ï¼Œ
\[
  \comap(f)(S)_i \colonequiv f^{-1}(S_i) = \{x \in \alpha \mid f(x) \in S_i\}
\]
ã«ã‚ˆã‚Šå¡” $\comap(f)(S) \in \mathrm{StructureTower}(\iota,\alpha)$ ã‚’å®šç¾©ã™ã‚‹ï¼
\end{definition}

\begin{definition}[reindex]
\label{def:reindex}
å˜èª¿å†™åƒ $\varphi\colon (\iota,\leq) \to (\kappa,\leq)$ ã¨
å¡” $T \in \mathrm{StructureTower}(\kappa,\alpha)$ ã«å¯¾ã—ã¦ï¼Œ
\[
  \reindex(\varphi)(T)_i \colonequiv T_{\varphi(i)}
\]
ã«ã‚ˆã‚Šå¡” $\reindex(\varphi)(T) \in \mathrm{StructureTower}(\iota,\alpha)$ ã‚’å®šç¾©ã™ã‚‹ï¼
\end{definition}

\begin{figure}[H]
\centering
\begin{tikzcd}[column sep=5em, row sep=3em]
  \mathrm{ST}(\iota,\alpha)
    \arrow[r, "\map(f)", bend left=15]
    \arrow[d, "\reindex(\varphi)"']
  & \mathrm{ST}(\iota,\beta)
    \arrow[l, "\comap(f)", bend left=15]
    \arrow[d, "\reindex(\varphi)"] \\
  \mathrm{ST}(\kappa,\alpha)
    \arrow[r, "\map(f)"', bend right=15]
  & \mathrm{ST}(\kappa,\beta)
    \arrow[l, "\comap(f)"', bend right=15]
\end{tikzcd}
\caption{3ç¨®ã®é–¢æ‰‹çš„æ“ä½œã®é–¢ä¿‚ï¼$\map(f)$ ã¨ $\reindex(\varphi)$ ã¯å¯æ›
ï¼ˆå®šç†~\ref{thm:map-reindex-comm}ï¼‰ï¼
$\comap(f) \dashv \map(f)$ ã¯ã“ã“ã§ã¯éšä¼´ã§ã¯ãªãï¼Œadjoint-like ãªæ€§è³ªï¼ˆå‘½é¡Œ~\ref{prop:adjoint}ï¼‰ã‚’æŒã¤ï¼}
\label{fig:three-functors}
\end{figure}

\begin{theorem}[é–¢æ‰‹æ³•å‰‡]
\label{thm:functor-laws}
\mbox{}
\begin{enumerate}
  \item $\map(\mathrm{id}) = \mathrm{id}$ï¼Œ$\map(g \circ f) = \map(g) \circ \map(f)$
  \item $\comap(\mathrm{id}) = \mathrm{id}$ï¼Œ$\comap(f) \circ \comap(g) = \comap(g \circ f)$
  \item $\reindex(\mathrm{id}) = \mathrm{id}$ï¼Œ$\reindex(g \circ f) = \reindex(f) \circ \reindex(g)$
\end{enumerate}
ã™ãªã‚ã¡ $\map$ ã¯å…±å¤‰é–¢æ‰‹ï¼Œ$\comap$ ã¯åå¤‰é–¢æ‰‹ï¼Œ$\reindex$ ã¯æ·»å­—ã®åå¤‰é–¢æ‰‹ã§ã‚ã‚‹ï¼
\end{theorem}

\begin{theorem}[map ã¨ reindex ã®å¯æ›æ€§]
\label{thm:map-reindex-comm}
å˜èª¿å†™åƒ $\varphi\colon\iota\to\kappa$ï¼Œé–¢æ•° $g\colon\alpha\to\beta$ ã«å¯¾ã—ï¼š
\[
  \map(g) \circ \reindex(\varphi) = \reindex(\varphi) \circ \map(g)
\]
\end{theorem}

\begin{proposition}[map--comap éšä¼´çš„é–¢ä¿‚]
\label{prop:adjoint}
$f\colon\alpha\to\beta$ï¼Œ$T \in \mathrm{ST}(\iota,\alpha)$ï¼Œ$S \in \mathrm{ST}(\iota,\beta)$ ã«å¯¾ã—ã¦ï¼š
\[
  \map(f)(T) \NatIncl S
  \;\iff\;
  T \NatIncl \comap(f)(S)
\]
\end{proposition}

\begin{figure}[H]
\centering
\begin{tikzcd}[column sep=6em]
  \mathrm{ST}(\iota,\alpha)
    \arrow[r, bend left=20, "\map(f)"{name=L, above}]
  & \mathrm{ST}(\iota,\beta)
    \arrow[l, bend left=20, "\comap(f)"{name=R, below}]
\end{tikzcd}
\quad $\map(f) \dashv \comap(f)$
\caption{$\map(f) \dashv \comap(f)$ï¼š
  $\map(f)(T) \NatIncl S \iff T \NatIncl \comap(f)(S)$ï¼
  å‰è€…ã®ã€Œå¡”ã®åƒãŒ $S$ ã«å«ã¾ã‚Œã‚‹ã€ã¨å¾Œè€…ã®ã€Œå¡”ãŒ $S$ ã®é€†åƒã«å«ã¾ã‚Œã‚‹ã€ãŒåŒå€¤ã«ãªã‚‹éšä¼´çš„å¯¾å¿œï¼}
\label{fig:adjunction}
\end{figure}

% =============================================================================
\section{æ¥µé™ãƒ»ä½™æ¥µé™}
\label{sec:limits}
% =============================================================================

åŒä¸€å° $\alpha$ ã®å¡”ã‚’å¯¾è±¡ï¼Œ$\NatIncl$ ã‚’å°„ã¨ã™ã‚‹åœã‚’è€ƒãˆã‚‹ã¨ï¼Œ
ã“ã®åœã¯ levelwise é›†åˆæ¼”ç®—ã«ã‚ˆã£ã¦è±Šå¯Œãªæ¥µé™ãƒ»ä½™æ¥µé™ã‚’æŒã¤ï¼

\begin{theorem}[çµ‚å¯¾è±¡ã¨å§‹å¯¾è±¡]
\label{thm:terminal-initial}
\mbox{}
\begin{itemize}
  \item \textbf{çµ‚å¯¾è±¡}ï¼š$\mathbf{1} = (T^{\mathbf{1}}_i \colonequiv \alpha)_{i\in\iota}$
    ï¼ˆå„ãƒ¬ãƒ™ãƒ«ãŒå…¨é›†åˆï¼‰ã¯çµ‚å¯¾è±¡ï¼ã™ãªã‚ã¡ä»»æ„ã® $T$ ã«å¯¾ã—ã¦ $T \NatIncl \mathbf{1}$ï¼
  \item \textbf{å§‹å¯¾è±¡}ï¼š$\mathbf{0} = (T^{\mathbf{0}}_i \colonequiv \emptyset)_{i\in\iota}$
    ï¼ˆå„ãƒ¬ãƒ™ãƒ«ãŒç©ºé›†åˆï¼‰ã¯å§‹å¯¾è±¡ï¼ã™ãªã‚ã¡ä»»æ„ã® $T$ ã«å¯¾ã—ã¦ $\mathbf{0} \NatIncl T$ï¼
\end{itemize}
\end{theorem}

\subsection{ç©ã¨ä½™ç©}

\begin{definition}[ç©ã¨ä½™ç©]
\label{def:prod-coprod}
å¡” $T_1, T_2 \in \mathrm{StructureTower}(\iota,\alpha)$ ã«å¯¾ã—ã¦ï¼š
\begin{align*}
  (T_1 \times T_2)_i &\colonequiv T_{1,i} \cap T_{2,i} \qquad (\text{ç©}) \\
  (T_1 + T_2)_i &\colonequiv T_{1,i} \cup T_{2,i} \qquad (\text{ä½™ç©})
\end{align*}
\end{definition}

\begin{theorem}[ç©ã®æ™®éæ€§]
\label{thm:prod-univ}
ä»»æ„ã®å¡” $S$ ã«å¯¾ã—ã¦ï¼Œ
\[
  S \NatIncl (T_1 \times T_2)
  \;\iff\;
  S \NatIncl T_1 \;\text{ ã‹ã¤ }\; S \NatIncl T_2
\]
\end{theorem}

\begin{figure}[H]
\centering
\begin{tikzcd}[column sep=4em, row sep=3em]
  & S \arrow[dl, "\exists!\,h"'] \arrow[d, dashed] \arrow[dr, "k_2"] & \\
  T_1 & T_1 \times T_2 \arrow[l, "\pi_1"] \arrow[r, "\pi_2"'] & T_2
\end{tikzcd}
\caption{ç©ã®æ™®éæ€§ï¼š$S$ ã‹ã‚‰ $T_1$ ã¨ $T_2$ ã¸ã® $\NatIncl$ ã®å¯¾ãŒã‚ã‚Œã°ï¼Œ
$S \to T_1 \times T_2$ ã¸ä¸€æ„ã«å› æ•°åˆ†è§£ã•ã‚Œã‚‹ï¼ˆã“ã“ã§çŸ¢å°ã¯ $\NatIncl$ï¼‰ï¼
Lean ã§ã¯ \texttt{prod\_univ} ã¨ã—ã¦è¨¼æ˜æ¸ˆã¿ï¼}
\label{fig:product-universal}
\end{figure}

\begin{theorem}[ä½™ç©ã®æ™®éæ€§]
\label{thm:coprod-univ}
ä»»æ„ã®å¡” $S$ ã«å¯¾ã—ã¦ï¼Œ
\[
  (T_1 + T_2) \NatIncl S
  \;\iff\;
  T_1 \NatIncl S \;\text{ ã‹ã¤ }\; T_2 \NatIncl S
\]
\end{theorem}

\begin{figure}[H]
\centering
\begin{tikzcd}[column sep=4em, row sep=3em]
  T_1 \arrow[r, "\iota_1"] \arrow[dr, "h_1"'] & T_1 + T_2 \arrow[d, dashed, "\exists!\,h"] & T_2 \arrow[l, "\iota_2"'] \arrow[dl, "h_2"] \\
  & S &
\end{tikzcd}
\caption{ä½™ç©ã®æ™®éæ€§ï¼š$T_1$ ã¨ $T_2$ ã‹ã‚‰ $S$ ã¸ã® $\NatIncl$ ã®å¯¾ãŒã‚ã‚Œã°ï¼Œ
$T_1 + T_2 \to S$ ã¸ä¸€æ„ã«å› æ•°åˆ†è§£ã•ã‚Œã‚‹ï¼}
\label{fig:coproduct-universal}
\end{figure}

\subsection{ç„¡é™ç©ãƒ»ä½™ç©}

\begin{definition}[indexed iInf / iSup]
\label{def:iinf-isup}
æ— $(T_s)_{s\in\sigma}$ï¼ˆ$\sigma$ ã¯ä»»æ„ã®å‹ï¼‰ã«å¯¾ã—ã¦ï¼š
\begin{align*}
  \left(\bigwedge_{s\in\sigma} T_s\right)_i &\colonequiv \bigcap_{s\in\sigma} (T_s)_i \\
  \left(\bigvee_{s\in\sigma} T_s\right)_i &\colonequiv \bigcup_{s\in\sigma} (T_s)_i
\end{align*}
\end{definition}

\begin{proposition}
\label{prop:prod-as-iinf}
$T_1 \times T_2 = \bigwedge_{b\in\mathbf{2}} (b \,?\, T_1 \,:\, T_2)$ï¼Œ
ã™ãªã‚ã¡ç©ã¯ 2 å…ƒæ—ã® $\mathrm{iInf}$ ã®ç‰¹æ®Šä¾‹ã§ã‚ã‚‹ï¼
\end{proposition}

\subsection{ç­‰åŒ–å­}

\begin{definition}[ç­‰åŒ–å­]
\label{def:equalizer}
åŒä¸€å°ã®å¡”é–“ã«ãŠã‘ã‚‹ç­‰åŒ–å­ã¯ï¼Œç©ã¨ä¸€è‡´ã™ã‚‹ï¼š
\[
  \mathrm{eq}(T_1, T_2) \colonequiv T_1 \times T_2
\]
\end{definition}

\begin{remark}
åŒä¸€å°ã®å ´åˆï¼Œ$\NatIncl$ ã®å°„ã¯é›†åˆã®åŒ…å«ã§ã‚ã‚‹ãŸã‚ï¼Œ
ç­‰åŒ–å­ã¯ç©ï¼ˆlevelwise äº¤å‰ï¼‰ã¨ç­‰ã—ããªã‚‹ï¼
ä¸€èˆ¬ã®åœè«–çš„ç­‰åŒ–å­ã¯å°„ã®ç­‰åŒ–ã‚’è¡¨ã™ãŒï¼Œã“ã“ã§ã¯ç‰¹æ®ŠåŒ–ã—ãŸçŠ¶æ³ã«ã‚ã‚‹ï¼
\end{remark}

\begin{figure}[H]
\centering
\begin{tikzpicture}[scale=1.0]
  \node[draw, rounded corners, fill=blue!5, minimum width=2cm, minimum height=1cm]
    (S) at (0,0) {$S$};
  \node[draw, rounded corners, fill=green!5, minimum width=2cm, minimum height=1cm]
    (eq) at (3,0) {$\mathrm{eq}(T_1,T_2)$};
  \node[draw, rounded corners, fill=red!5, minimum width=2cm, minimum height=1cm]
    (T1) at (6,1) {$T_1$};
  \node[draw, rounded corners, fill=red!5, minimum width=2cm, minimum height=1cm]
    (T2) at (6,-1) {$T_2$};
  \draw[->] (S) -- (eq) node[above,midway,font=\small] {$\exists!$};
  \draw[->] (eq) -- (T1) node[above,sloped,font=\small] {$\pi_1$};
  \draw[->] (eq) -- (T2) node[below,sloped,font=\small] {$\pi_2$};
  \draw[->, bend left=20] (S) to node[above,font=\small] {$h_1$} (T1);
  \draw[->, bend right=20] (S) to node[below,font=\small] {$h_2$} (T2);
\end{tikzpicture}
\caption{ç­‰åŒ–å­ã®æ™®éæ€§ï¼ˆåŒä¸€å°ã§ã¯ç©ã¨ä¸€è‡´ï¼‰ï¼}
\label{fig:equalizer}
\end{figure}

% =============================================================================
\section{é–‰åŒ…ãƒ¢ãƒŠãƒ‰ã¨ Kleisli / Eilenberg--Moore ç†è«–}
\label{sec:monad}
% =============================================================================

\subsection{é–‰åŒ…ä½œç”¨ç´ ã‹ã‚‰å®šã¾ã‚‹å¡”}

\begin{definition}[é–‰åŒ…ä½œç”¨ç´ ã®å¡”]
\label{def:tower-of-closure}
$(\alpha, \leq)$ ã‚’åŠé †åºé›†åˆï¼Œ$c\colon\alpha\to\alpha$ ã‚’é–‰åŒ…ä½œç”¨ç´ ã¨ã™ã‚‹ï¼
ã™ãªã‚ã¡ $c$ ã¯å˜èª¿ï¼Œå†ªç­‰ï¼ˆ$c \circ c = c$ï¼‰ï¼Œã‹ã¤ $\mathrm{id} \leq c$ ã‚’æº€ãŸã™ï¼
ã“ã®ã¨ãï¼š
\[
  (T^c)_x \colonequiv \{y \in \alpha \mid y \leq c(x)\} = {\downarrow}\,c(x)
\]
ã«ã‚ˆã£ã¦å¡” $T^c \in \mathrm{StructureTower}(\alpha, \alpha)$ ãŒå®šã¾ã‚‹ï¼
\end{definition}

\begin{theorem}[ãƒ¢ãƒŠãƒ‰ã®å…¬ç†]
\label{thm:monad-axioms}
$T^c$ ã«ãŠã„ã¦ï¼Œé–‰åŒ…ä½œç”¨ç´ ã®ãƒ¢ãƒŠãƒ‰æ§‹é€ ã®å…¬ç†ãŒæˆç«‹ã™ã‚‹ï¼š
\begin{enumerate}
  \item \textbf{å˜ä½ (unit)}ï¼š$x \in (T^c)_x$ï¼Œã™ãªã‚ã¡ $x \leq c(x)$
  \item \textbf{ä¹—æ³• (mult)}ï¼š$(T^c)_{c(x)} = (T^c)_x$ï¼Œã™ãªã‚ã¡ $c(c(x)) = c(x)$
\end{enumerate}
\end{theorem}

\begin{figure}[H]
\centering
\begin{tikzcd}[column sep=5em, row sep=4em]
  T^c \arrow[r, "\eta"] \arrow[dr, "\mathrm{id}"'] & T^c \circ T^c \arrow[d, "\mu"] \\
  & T^c
\end{tikzcd}
\qquad
\begin{tikzcd}[column sep=5em, row sep=4em]
  T^c \circ T^c \arrow[r, "T^c \eta"] \arrow[d, "\mu"'] & T^c \circ T^c \circ T^c \arrow[d, "\mu_{T^c}"] \\
  T^c \arrow[r, "\mu"'] & T^c \circ T^c
\end{tikzcd}
\caption{ãƒ¢ãƒŠãƒ‰ã®å…¬ç†å›³å¼ï¼ˆå˜ä½å¾‹ã¨çµåˆå¾‹ï¼‰ï¼
  $\eta\colon x \mapsto c(x)$ï¼ˆunitï¼‰ï¼Œ$\mu\colon c(c(x)) = c(x)$ï¼ˆidempotency / multï¼‰ï¼}
\label{fig:monad-axioms}
\end{figure}

\subsection{Galois æ¥ç¶šã‹ã‚‰ã®æ§‹æˆ}

\begin{definition}[Galois æ¥ç¶šã®å¡”]
\label{def:tower-of-galois}
$l\colon\alpha\to\beta$, $u\colon\beta\to\alpha$ ãŒ Galois æ¥ç¶š
$l \dashv u$ï¼ˆ$l(x) \leq y \iff x \leq u(y)$ï¼‰ã‚’å½¢æˆã™ã‚‹ã¨ãï¼Œ
$c_{l,u} \colonequiv u \circ l$ ã¯é–‰åŒ…ä½œç”¨ç´ ã¨ãªã‚‹ï¼ã“ã®ã¨ãï¼š
\[
  T^{l,u} \colonequiv T^{c_{l,u}}
\]
\end{definition}

\begin{figure}[H]
\centering
\begin{tikzcd}[column sep=5em, row sep=2em]
  (\alpha, \leq)
    \arrow[r, bend left=25, "l"{above}]
  & (\beta, \leq)
    \arrow[l, bend left=25, "u"{below}]
\end{tikzcd}
\quad ($l \dashv u$)
\qquad
$\Longrightarrow$
\qquad
$c = u \circ l$ï¼ˆé–‰åŒ…ä½œç”¨ç´ ï¼‰
\caption{Galois æ¥ç¶š $l \dashv u$ ã‹ã‚‰é–‰åŒ…ä½œç”¨ç´  $c = u \circ l$ ãŒå®šã¾ã‚Šï¼Œ
ãã‚ŒãŒå¡” $T^{l,u}$ ã‚’æ±ºå®šã™ã‚‹ï¼}
\label{fig:galois}
\end{figure}

\subsection{Kleisli åœ}

\begin{definition}[Kleisli åœ]
\label{def:kleisli}
é–‰åŒ…ä½œç”¨ç´  $c$ ã«å¯¾ã—ã¦ï¼Œ\emph{Kleisli åœ} $\Kl(c)$ ã‚’æ¬¡ã§å®šç¾©ã™ã‚‹ï¼š
\begin{itemize}
  \item \textbf{å¯¾è±¡}ï¼š$\alpha$ ã®å…ƒ $x$
  \item \textbf{å°„} $x \to_{\Kl} y$ï¼š$x \leq c(y)$ ãŒæˆç«‹ã™ã‚‹ã“ã¨ã‚’è¡¨ã™å‘½é¡Œ
  \item \textbf{æ’ç­‰å°„}ï¼š$x \to_{\Kl} x$ï¼ˆ$x \leq c(x)$ï¼Œunit ã‹ã‚‰ï¼‰
  \item \textbf{åˆæˆ}ï¼š$x \to_{\Kl} y$, $y \to_{\Kl} z$ ãªã‚‰ã°
    $x \leq c(y) \leq c(c(z)) = c(z)$ï¼Œã‚†ãˆã« $x \to_{\Kl} z$
\end{itemize}
ç›´æ„Ÿçš„ã«ï¼Œ$x \to_{\Kl} y$ ã¯ã€Œ$x$ ãŒ $c$ ã®è¿‘ä¼¼ãƒ»é£½å’Œã®æ„å‘³ã§ $y$ ã«åˆ°é”å¯èƒ½ã€ã‚’æ„å‘³ã™ã‚‹ï¼
\end{definition}

\begin{figure}[H]
\centering
\begin{tikzcd}[column sep=4em, row sep=3em]
  x
    \arrow[r, "{\leq c(y)}"]
    \arrow[rr, bend right=20, "{\leq c(z)}"']
  & y \arrow[r, "{\leq c(z)}"]
  & z
\end{tikzcd}
\caption{Kleisli åœã«ãŠã‘ã‚‹å°„ã®åˆæˆï¼š
$x \leq c(y)$ ã¨ $y \leq c(z)$ ã‹ã‚‰ $c(y) \leq c(c(z)) = c(z)$ ã‚’çµŒã¦ $x \leq c(z)$ï¼
é–‰åŒ…ä½œç”¨ç´ ã®å†ªç­‰æ€§ãŒæœ¬è³ªçš„ã«ä½¿ã‚ã‚Œã‚‹ï¼}
\label{fig:kleisli-composition}
\end{figure}

\subsection{Eilenberg--Moore ä»£æ•°}

\begin{definition}[EM ä»£æ•°]
\label{def:em-algebras}
$x \in \alpha$ ãŒ \emph{Eilenberg--Moore ä»£æ•°}ï¼ˆã¾ãŸã¯ \emph{é–‰å…ƒ}ï¼‰ã§ã‚ã‚‹ã¨ã¯ï¼Œ
\[
  c(x) \leq x
\]
ãŒæˆç«‹ã™ã‚‹ã“ã¨ã‚’ã„ã†ï¼$\EMAlg(c) \colonequiv \{x \in \alpha \mid c(x) \leq x\}$.
\end{definition}

\begin{theorem}[é–‰å…ƒã®ç‰¹å¾´ä»˜ã‘]
\label{thm:em-characterization}
\[
  x \in \EMAlg(c) \;\iff\; c(x) = x
\]
ã™ãªã‚ã¡ EM ä»£æ•°å…¨ä½“ã¯ $c$ ã®ä¸å‹•ç‚¹é›†åˆ $\Fix(c)$ ã¨ä¸€è‡´ã™ã‚‹ï¼
\end{theorem}

\begin{proof}
$c(x) \leq x$ ã¨ $x \leq c(x)$ï¼ˆunit æ¡ä»¶ï¼‰ã‚’åˆã‚ã›ã‚Œã° $c(x) = x$ï¼
é€†ã« $c(x) = x$ ãªã‚‰ã° $c(x) \leq x$ ã¯è‡ªæ˜ï¼
\end{proof}

\begin{figure}[H]
\centering
\begin{tikzpicture}[scale=1.2]
  \draw[fill=blue!8, draw=blue!40, rounded corners] (-1.5,-1.5) rectangle (1.5,1.5);
  \node[blue!60, font=\small] at (0, 1.2) {$\alpha$};
  \draw[fill=green!20, draw=green!60, rounded corners] (-0.8,-0.8) rectangle (0.8,0.8);
  \node[green!80, font=\small] at (0, 0.55) {$\Fix(c) = \EMAlg(c)$};
  \node[font=\tiny] at (0, 0) {$c(x) = x$};
  % arrow from outside showing c maps to inside
  \draw[->, thick, red!60] (-1.3, -1.0) to[bend left=30] node[above,font=\tiny,red!80] {$c$} (-0.6,-0.5);
  \node[red!60, font=\tiny] at (-1.3,-1.2) {$x$};
\end{tikzpicture}
\caption{$c\colon\alpha\to\alpha$ ã¯ä»»æ„ã® $x$ ã‚’ä¸å‹•ç‚¹é›†åˆ $\Fix(c)$ ã«å†™ã™ï¼
  $\EMAlg(c) = \Fix(c)$ ã§ã‚ã‚Šï¼ŒEM ä»£æ•°ã¯ $c$ ã® "å®‰å®šç‚¹" ã®é›†åˆï¼}
\label{fig:em-algebras}
\end{figure}

% =============================================================================
\section{OrderHom ã¨ã®åŒå€¤}
\label{sec:orderhom}
% =============================================================================

\begin{theorem}[OrderHom ã¨ã®åŒå€¤]
\label{thm:orderhom-equiv}
ä»¥ä¸‹ã®2ã¤ã®å†™åƒï¼š
\begin{align*}
  \Phi\colon \mathrm{StructureTower}(\iota,\alpha) &\to \OrderHom(\iota, \mathcal{P}(\alpha)) \\
  T &\mapsto (i \mapsto T_i) \\[1em]
  \Psi\colon \OrderHom(\iota, \mathcal{P}(\alpha)) &\to \mathrm{StructureTower}(\iota,\alpha) \\
  h &\mapsto (h_i)_{i\in\iota}
\end{align*}
ã¯äº’ã„ã«é€†ã§ã‚ã‚Šï¼Œ$\Phi \circ \Psi = \mathrm{id}$, $\Psi \circ \Phi = \mathrm{id}$ ãŒæˆç«‹ã™ã‚‹ï¼
ã—ãŸãŒã£ã¦ï¼Œ
\[
  \mathrm{StructureTower}(\iota,\alpha) \;\simeq\; \OrderHom(\iota, \mathcal{P}(\alpha))
\]
\end{theorem}

\begin{figure}[H]
\centering
\begin{tikzcd}[column sep=6em, row sep=4em]
  \mathrm{StructureTower}(\iota,\alpha)
    \arrow[r, bend left=20, "\Phi"]
    \arrow[loop left, "\mathrm{id}"]
  & \OrderHom(\iota,\mathcal{P}(\alpha))
    \arrow[l, bend left=20, "\Psi"]
    \arrow[loop right, "\mathrm{id}"]
\end{tikzcd}
\caption{StructureTower ã¨ OrderHom ã®åŒå€¤ï¼$\Phi \circ \Psi = \mathrm{id}$ ã‹ã¤
$\Psi \circ \Phi = \mathrm{id}$ï¼}
\label{fig:equivalence}
\end{figure}

\begin{proposition}[NatInclusion ã® OrderHom çš„è§£é‡ˆ]
\label{prop:nat-orderhom}
$T_1 \NatIncl T_2 \iff \Phi(T_1) \leq \Phi(T_2)$ï¼ˆ$\OrderHom$ ã®ç‚¹çŠ¶é †åºï¼‰
\end{proposition}

\begin{mathinsight}
ã“ã®åŒå€¤ã¯ã€ŒStructureTower ãŒ OrderHom ã‚ˆã‚Šã‚‚è±Šã‹ãªæ§‹é€ ã‚’æŒã¤ã‹ï¼Ÿã€ã¨ã„ã†å•ã„ã¸ã®ç­”ãˆã‚’ä¸ãˆã‚‹ï¼
ç´”ç²‹ãªé›†åˆè«–çš„æ„å‘³ã§ã¯ä¸¡è€…ã¯åŒã˜ã§ã‚ã‚‹ï¼
ã—ã‹ã— Â§3â€“Â§5 ã§æ§‹æˆã—ãŸ $\map$, $\comap$, $\reindex$ï¼Œ
ãã—ã¦é–‰åŒ…ãƒ¢ãƒŠãƒ‰ã®æ§‹é€ ã¯ï¼ŒOrderHom ã®è¨€è‘‰ã§ã¯è¡¨ç¾ã—ã«ãã„ä»£æ•°çš„åˆ¶ç´„ã‚’æ˜ç¤ºåŒ–ã—ã¦ã„ã‚‹ï¼
\end{mathinsight}

% =============================================================================
\section{æ¼”ç¿’å•é¡Œï¼ˆLean 4 å½¢å¼åŒ–ã‚ˆã‚Šï¼‰}
\label{sec:exercises}
% =============================================================================

ä»¥ä¸‹ã¯ Lean 4 ãƒ•ã‚¡ã‚¤ãƒ«ã® Â§7 ã«å¯¾å¿œã™ã‚‹æ¼”ç¿’å•é¡Œã®æ•°å­¦çš„è§£èª¬ã§ã‚ã‚‹ï¼
é›£æ˜“åº¦ã¯ ğŸŸ¢ï¼ˆæ˜“ï¼‰/ ğŸŸ¡ï¼ˆä¸­ï¼‰/ ğŸ”´ï¼ˆé›£ï¼‰ã§ç¤ºã™ï¼

\subsection*{Group Aï¼šå®šç¾©ã®å±•é–‹}

\begin{exercisebox}
\textbf{A1 ğŸŸ¢ map ã‹ã‚‰ Hom ã‚’æ§‹æˆã›ã‚ˆ}

$f\colon\alpha\to\beta$ ã¨ $T \in \mathrm{ST}(\iota,\alpha)$ ã«å¯¾ã—ã¦ï¼Œ
$\Hom(T, \map(f)(T))$ ã®å…ƒã‚’æ§‹æˆã›ã‚ˆï¼

\textit{ãƒ’ãƒ³ãƒˆ}ï¼šå°„ã®å°é–¢æ•°ã¯ $f$ è‡ªèº«ï¼ä¿å­˜æ¡ä»¶ã¯ $f(x) \in f(T_i)$ ã¨ã„ã†å®šç¾©ã‹ã‚‰ç›´æ¥ï¼
\end{exercisebox}

\begin{exercisebox}
\textbf{A3 ğŸŸ¢ iInf ã®å°„å½±}

$S \NatIncl \bigwedge_{s\in\sigma} T_s$ ã‹ã‚‰ $S \NatIncl T_{s_0}$ï¼ˆå›ºå®š $s_0\in\sigma$ï¼‰ã‚’ç¤ºã›ï¼

\textit{ãƒ’ãƒ³ãƒˆ}ï¼š$\bigwedge$ ã®å®šç¾©ã‚ˆã‚Š $x \in \bigcap_s (T_s)_i \Rightarrow x \in (T_{s_0})_i$ï¼
\end{exercisebox}

\subsection*{Group Bï¼šè£œé¡Œã®çµ„ã¿åˆã‚ã›}

\begin{exercisebox}
\textbf{B1 ğŸŸ¡ map--comap éšä¼´}

$\map(f)(T) \NatIncl S \iff T \NatIncl \comap(f)(S)$ ã‚’è¨¼æ˜ã›ã‚ˆï¼ˆå‘½é¡Œ~\ref{prop:adjoint}ï¼‰ï¼

\textit{æ ¸å¿ƒ}ï¼š
\begin{align*}
(\to)&: x \in T_i \Rightarrow f(x) \in \map(f)(T)_i \subseteq S_i \Rightarrow x \in f^{-1}(S_i) \\
(\leftarrow)&: y \in \map(f)(T)_i \Rightarrow y=f(x),\, x\in T_i \Rightarrow
  x\in\comap(f)(S)_i \Rightarrow f(x)\in S_i
\end{align*}
\end{exercisebox}

\begin{exercisebox}
\textbf{B3 ğŸŸ¡ Kleisli åˆæˆã®çµåˆå¾‹}

$x \to_{\Kl} y$, $y \to_{\Kl} z$, $z \to_{\Kl} w$ ãªã‚‰ã° $x \to_{\Kl} w$ ã‚’ç¤ºã›ï¼

\textit{æ ¸å¿ƒ}ï¼š$\mathtt{kleisli\_comp}$ ã‚’2å›é©ç”¨ã™ã‚‹ï¼
$x \leq c(y)$, $y \leq c(z)$ ã‹ã‚‰ $x \leq c(z)$ï¼ˆ1å›ç›®ï¼‰ï¼Œ
ã•ã‚‰ã« $z \leq c(w)$ ã¨åˆã‚ã›ã¦ $x \leq c(w)$ï¼ˆ2å›ç›®ï¼‰ï¼
\end{exercisebox}

\subsection*{Group Cï¼šåœè«–çš„æ¨è«–}

\begin{exercisebox}
\textbf{C1 ğŸ”´ map ã® Hom ã¸ã®ä½œç”¨}

$g\colon\Hom(T_1, T_2)$ ã¨ $\beta$ ä¸Šã®é–¢æ•° $g_\beta\colon\beta\to\beta$
ã§ã‚ã£ã¦ $g_\beta \circ f = f \circ g$ ã‚’æº€ãŸã™ã‚‚ã®ãŒä¸ãˆã‚‰ã‚ŒãŸã¨ãï¼Œ
$\Hom(\map(f)(T_1), \map(f)(T_2))$ ã®å…ƒã‚’æ§‹æˆã›ã‚ˆï¼

ã“ã®æ§‹æˆã¯é–¢æ‰‹ $\map(f)\colon\Tower(\iota)\to\Tower(\iota)$ ã®å°„ã¸ã®ä½œç”¨ã«å¯¾å¿œã™ã‚‹ï¼š
\[
\begin{tikzcd}[column sep=4em, row sep=3em]
  T_1 \arrow[r, "g"] \arrow[d, "\map(f)"'] & T_2 \arrow[d, "\map(f)"] \\
  \map(f)(T_1) \arrow[r, dashed, "\exists\,h"] & \map(f)(T_2)
\end{tikzcd}
\]
\end{exercisebox}

\begin{exercisebox}
\textbf{C4 ğŸ”´ Galois æ¥ç¶šã®å˜èª¿æ€§ã¨ NatInclusion}

$l_1, l_2\colon\alpha\to\beta$ ã¨ $u_1, u_2\colon\beta\to\alpha$ ãŒ
ãã‚Œãã‚Œ Galois æ¥ç¶š $l_k \dashv u_k$ ã‚’å½¢æˆã—ï¼Œ
$l_1(x) \leq l_2(x)$ï¼ˆ$\forall x$ï¼‰ã‹ã¤ $u_1(y) \leq u_2(y)$ï¼ˆ$\forall y$ï¼‰ãŒ
æˆã‚Šç«‹ã¤ã¨ãï¼Œ$T^{l_1,u_1} \NatIncl T^{l_2,u_2}$ ã‚’ç¤ºã›ï¼

\textit{æ ¸å¿ƒ}ï¼š
$y \leq u_1(l_1(x))$ ã‚’ä»®å®šã—ã¦ $y \leq u_2(l_2(x))$ ã‚’ç¤ºã™ï¼
$u_1(l_1(x)) \leq u_2(l_2(x))$ ã¯ $u_1 \leq u_2$ ã¨ $u_2$ ã®å˜èª¿æ€§ã‹ã‚‰ï¼š
\[
  u_1(l_1(x)) \leq u_2(l_1(x)) \leq u_2(l_2(x))
\]
\end{exercisebox}

% =============================================================================
\section{ã¾ã¨ã‚}
\label{sec:conclusion}
% =============================================================================

æœ¬ç¨¿ã§ã¯ï¼Œæ§‹é€ å¡” $\mathrm{StructureTower}(\iota,\alpha)$ ã®åœè«–çš„æ§‹é€ ã‚’ Lean 4 å½¢å¼åŒ–ã‚’ã‚‚ã¨ã«è§£èª¬ã—ãŸï¼

\begin{table}[H]
\centering
\small
\begin{tabular}{lll}
\toprule
\textbf{æ¦‚å¿µ} & \textbf{æ•°å­¦çš„å†…å®¹} & \textbf{Lean ã®å®šç¾©å} \\
\midrule
å¯¾è±¡ã®åœ & $\Tower(\iota)$ï¼šãƒ¬ãƒ™ãƒ«ä¿å­˜å†™åƒ & \texttt{Hom} \\
è‡ªç„¶å¤‰æ› & levelwise åŒ…å« $\NatIncl$ & \texttt{NatInclusion} \\
å…±å¤‰é–¢æ‰‹ & $\map(f)\colon \mathrm{ST}(\iota,\alpha)\to\mathrm{ST}(\iota,\beta)$ & \texttt{map} \\
åå¤‰é–¢æ‰‹ & $\comap(f)\colon \mathrm{ST}(\iota,\beta)\to\mathrm{ST}(\iota,\alpha)$ & \texttt{comap} \\
å†æ·»å­—é–¢æ‰‹ & $\reindex(\varphi)\colon \mathrm{ST}(\kappa,\alpha)\to\mathrm{ST}(\iota,\alpha)$ & \texttt{reindex} \\
ç© & levelwise äº¤å‰ $T_{1,i}\cap T_{2,i}$ & \texttt{prod} \\
ä½™ç© & levelwise åˆä½µ $T_{1,i}\cup T_{2,i}$ & \texttt{coprod} \\
çµ‚å¯¾è±¡ & å…¨é›†åˆã®å®šæ•°å¡” & \texttt{terminal} \\
å§‹å¯¾è±¡ & ç©ºé›†åˆã®å®šæ•°å¡” & \texttt{initial} \\
é–‰åŒ…ãƒ¢ãƒŠãƒ‰ & $c$ ã«ã‚ˆã‚‹å¡” $T^c_x = {\downarrow}\,c(x)$ & \texttt{towerOfClosure} \\
Kleisli åœ & å°„ $x \to_{\Kl} y \colonequiv x \leq c(y)$ & \texttt{IsKleisliArrow} \\
EM ä»£æ•° & $\Fix(c) = \{x \mid c(x) = x\}$ & \texttt{EMAlgebras} \\
åŒå€¤ & $\mathrm{ST}(\iota,\alpha) \simeq \OrderHom(\iota,\mathcal{P}(\alpha))$ & \texttt{toOrderHom} / \texttt{ofOrderHom} \\
\bottomrule
\end{tabular}
\caption{æœ¬ç¨¿ã§æ‰±ã£ãŸä¸»è¦æ¦‚å¿µã®å¯¾å¿œè¡¨}
\label{tab:summary}
\end{table}

\begin{mathinsight}
levelwise ã¨ã„ã†æ“ä½œã®åŸç†ã¯å¾¹åº•ã—ã¦ã„ã‚‹ï¼šäº¤å‰, åˆä½µ, åƒ, é€†åƒ, å†æ·»å­—â€•â€•
ã™ã¹ã¦ãŒã€Œå„ãƒ¬ãƒ™ãƒ« $i$ ã§ç‹¬ç«‹ã«è¡Œã„ï¼Œå˜èª¿æ€§ã‚’ç¶™æ‰¿ã™ã‚‹ã€ã¨ã„ã†ãƒ‘ã‚¿ãƒ¼ãƒ³ã«å¾“ã†ï¼
ã“ã®ä¸€è²«æ€§ãŒ Lean ã®è¨¼æ˜ã‚’å˜ç´”ã«ä¿ã¡ï¼Œåœè«–çš„ç›´è¦³ã‚’å½¢å¼åŒ–ã®ä¸­ã«é€æ˜ã«æ˜ ã—å‡ºã—ã¦ã„ã‚‹ï¼
\end{mathinsight}

% =============================================================================
\end{document}
